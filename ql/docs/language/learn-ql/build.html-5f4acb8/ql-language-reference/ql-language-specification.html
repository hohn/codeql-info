<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>QL language specification &#8212; CodeQL</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=93459777" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Evaluation of QL programs" href="evaluation-of-ql-programs.html" />

<title>CodeQL docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="../_static/custom.css" type="text/css" />
<link rel="stylesheet" href="../_static/primer.css" type="text/css" />


  </head><body>
<header class="Header">
    <div class="Header-item--full">
        <a href="https://codeql.github.com/docs" class="Header-link f2 d-flex flex-items-center">
            <!-- <%= octicon "mark-github", class: "mr-2", height: 32 %> -->
            <svg height="32" class="octicon octicon-mark-github mr-2" viewBox="0 0 16 16" version="1.1" width="32"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
            <span class="hide-sm">CodeQL documentation</span>
        </a>
    </div>
    <div class="Header-item hide-sm hide-md">
        <script src="https://addsearch.com/js/?key=93b4d287e2fc079a4089412b669785d5&categories=!0xhelp.semmle.com,0xcodeql.github.com,1xdocs,1xcodeql-standard-libraries,1xcodeql-query-help"></script>
    </div>
    <div class="Header-item">

        <details class="dropdown details-reset details-overlay d-inline-block">
            <summary class="btn bg-gray-dark text-white border" aria-haspopup="true">
                CodeQL resources
                <div class="dropdown-caret"></div>
            </summary>

            <ul class="dropdown-menu dropdown-menu-se dropdown-menu-dark">
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-overview">CodeQL overview</a></li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    CodeQL tools
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-for-visual-studio-code">CodeQL for VS Code</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-cli">CodeQL CLI</a>
                </li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    CodeQL guides
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/writing-codeql-queries">Writing CodeQL queries</a></li>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-language-guides">CodeQL language guides</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Reference docs
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/ql-language-reference/">QL language
                        reference</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/codeql-standard-libraries">CodeQL
                        standard-libraries</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/codeql-query-help">CodeQL
                        query help</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Source files
                </div>
                <li><a class="dropdown-item" href="https://github.com/github/codeql">CodeQL repository</a>
            </ul>
        </details>

    </div>

</header>
<main class="bg-gray-light clearfix">
<nav class="SideNav position-sticky top-0 col-lg-3 col-md-3 float-left p-4 hide-sm hide-md overflow-y-auto">

    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../codeql-overview/index.html">CodeQL overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-for-visual-studio-code/index.html">CodeQL for Visual Studio Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-cli/index.html">CodeQL CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../writing-codeql-queries/index.html">Writing CodeQL queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-language-guides/index.html">CodeQL language guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">QL language reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="about-the-ql-language.html">About the QL language</a></li>
<li class="toctree-l2"><a class="reference internal" href="predicates.html">Predicates</a></li>
<li class="toctree-l2"><a class="reference internal" href="queries.html">Queries</a></li>
<li class="toctree-l2"><a class="reference internal" href="types.html">Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="aliases.html">Aliases</a></li>
<li class="toctree-l2"><a class="reference internal" href="variables.html">Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="formulas.html">Formulas</a></li>
<li class="toctree-l2"><a class="reference internal" href="annotations.html">Annotations</a></li>
<li class="toctree-l2"><a class="reference internal" href="recursion.html">Recursion</a></li>
<li class="toctree-l2"><a class="reference internal" href="lexical-syntax.html">Lexical syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="name-resolution.html">Name resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="evaluation-of-ql-programs.html">Evaluation of QL programs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">QL language specification</a></li>
</ul>
</li>
</ul>


</nav>


<div class="body col-sm-12 col-md-9 col-lg-9 float-left border-left">

    <div class="hide-lg hide-xl px-4 pt-4">
        
<div class="related" role="navigation" aria-label="related navigation">
    <ul>
        <li class="nav-item nav-item-0"><a href="../contents.html">CodeQL</a> &#187;</li>
        <li class="nav-item nav-item-1"><a href="index.html"
                accesskey="U">QL language reference</a> &#187;</li> 
    </ul>
</div>
    </div>

    <article class="p-4 col-lg-10 col-md-10 col-sm-12">
        
  <section id="ql-language-specification">
<span id="id1"></span><h1>QL language specification<a class="headerlink" href="#ql-language-specification" title="Link to this heading">¶</a></h1>
<p>This is a formal specification for the QL language. It provides a comprehensive reference for terminology, syntax, and other technical details about QL.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">¶</a></h2>
<p>QL is a query language for CodeQL databases. The data is relational: named relations hold sets of tuples. The query language is a dialect of Datalog, using stratified semantics, and it includes object-oriented classes.</p>
</section>
<section id="notation">
<h2>Notation<a class="headerlink" href="#notation" title="Link to this heading">¶</a></h2>
<p>This section describes the notation used in the specification.</p>
<section id="unicode-characters">
<h3>Unicode characters<a class="headerlink" href="#unicode-characters" title="Link to this heading">¶</a></h3>
<p>Unicode characters in this document are described in two ways. One is to supply the character inline in the text, between double quote marks. The other is to write a capital U, followed by a plus sign, followed by a four-digit hexadecimal number representing the character’s code point. As an example of both, the first character in the name QL is “Q” (U+0051).</p>
</section>
<section id="grammars">
<h3>Grammars<a class="headerlink" href="#grammars" title="Link to this heading">¶</a></h3>
<p>The syntactic forms of QL constructs are specified using a modified Backus-Naur Form (BNF). Syntactic forms, including classes of tokens, are named using bare identifiers. Quoted text denotes a token by its exact sequence of characters in the source code.</p>
<p>BNF derivation rules are written as an identifier naming the syntactic element, followed by <code class="docutils literal notranslate"><span class="pre">::=</span></code>, followed by the syntax itself.</p>
<p>In the syntax itself, juxtaposition indicates sequencing. The vertical bar (<code class="docutils literal notranslate"><span class="pre">|</span></code>, U+007C) indicates alternate syntax. Parentheses indicate grouping. An asterisk (<code class="docutils literal notranslate"><span class="pre">*</span></code>, U+002A) indicates repetition zero or more times, and a plus sign (<code class="docutils literal notranslate"><span class="pre">+</span></code>, U+002B) indicates repetition one or more times. Syntax followed by a question mark (<code class="docutils literal notranslate"><span class="pre">?</span></code>, U+003F) indicates zero or one occurrences of that syntax.</p>
</section>
</section>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Link to this heading">¶</a></h2>
<p>A <em>QL program</em> consists of a query module defined in a QL file and a number of library modules defined in QLL files that it imports (see “<a class="reference external" href="#import-directives">Import directives</a>”). The module in the QL file includes one or more queries (see “<a class="reference external" href="#queries">Queries</a>”). A module may also include <em>import directives</em> (see “<a class="reference external" href="#import-directives">Import directives</a>”), non-member predicates (see “<a class="reference external" href="#non-member-predicates">Non-member predicates</a>”), class definitions (see “<a class="reference external" href="#classes">Classes</a>”), and module definitions (see “<a class="reference external" href="#modules">Modules</a>”).</p>
<p>QL programs are interpreted in the context of a <em>database</em> and a <em>library path</em> . The database provides a number of definitions: database types (see “<a class="reference external" href="#types">Types</a>”), entities (see “<a class="reference external" href="#values">Values</a>”), built-in predicates (see “<a class="reference external" href="#built-ins">Built-ins</a>”), and the <em>database content</em> of built-in predicates and external predicates (see “<a class="reference external" href="#evaluation">Evaluation</a>”). The library path is a sequence of file-system directories that hold QLL files.</p>
<p>A QL program can be <em>evaluated</em> (see “<a class="reference external" href="#evaluation">Evaluation</a>”) to produce a set of tuples of values (see “<a class="reference external" href="#values">Values</a>”).</p>
<p>For a QL program to be <em>valid</em>, it must conform to a variety of conditions that are described throughout this specification; otherwise the program is said to be <em>invalid</em>. An implementation of QL must detect all invalid programs and refuse to evaluate them.</p>
</section>
<section id="library-path">
<h2>Library path<a class="headerlink" href="#library-path" title="Link to this heading">¶</a></h2>
<p>The library path is an ordered list of directory locations. It is used
for resolving module imports (see “<a class="reference external" href="#module-resolution">Module resolution</a>”). The library path is not strictly
speaking a core part of the QL language, since different
implementations of QL construct it in slightly different ways. Most QL
tools also allow you to explicitly specify the library path on the command line for a
particular invocation, though that is rarely done, and only
useful in very special situations. This section describes the default
construction of the library path.</p>
<p>First, determine the <em>query directory</em> of the <code class="docutils literal notranslate"><span class="pre">.ql</span></code> file being
compiled. Starting with the directory containing the <code class="docutils literal notranslate"><span class="pre">.ql</span></code> file, and
walking up the directory structure, each directory is checked for a
file called <code class="docutils literal notranslate"><span class="pre">queries.xml</span></code> or <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code>. The first directory
where such a file is found is the query directory. If there is no such
directory, the directory of the <code class="docutils literal notranslate"><span class="pre">.ql</span></code> file itself is the query
directory.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">queries.xml</span></code> file that defines a query directory must always
contain a single top-level tag named
<code class="docutils literal notranslate"><span class="pre">queries</span></code>, which has a <code class="docutils literal notranslate"><span class="pre">language</span></code> attribute set to the identifier
of the active database schema (for example, <code class="docutils literal notranslate"><span class="pre">&lt;queries</span>
<span class="pre">language=&quot;java&quot;/&gt;</span></code>).</p>
<p>A <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> file defines a <a class="reference internal" href="../codeql-cli/about-ql-packs.html#about-ql-packs"><span class="std std-ref">QL pack</span></a>.
The content of a <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> file is described in the CodeQL CLI documentation.</p>
<p>If both a <code class="docutils literal notranslate"><span class="pre">queries.xml</span></code> and a <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> exist in the same
directory, the latter takes precedence (and the former is assumed to
exist for compatibility with older tooling).</p>
<p>The CodeQL CLI and newer tools based on it (such as,
GitHub code scanning and the CodeQL extension for Visual Studio Code)
construct a library path using QL packs. For each QL pack
added to the library path, the QL packs named in its
<code class="docutils literal notranslate"><span class="pre">libraryPathDependencies</span></code> will be subsequently added to the library
path, and the process continues until all packs have been
resolved. The actual library path consists of the root directories of
the selected QL packs. This process depends on a mechanism for finding
QL packs by pack name, as described in the <a class="reference internal" href="../codeql-cli/index.html#codeql-cli"><span class="std std-ref">CodeQL CLI documentation</span></a>.</p>
<p>When the query directory contains a <code class="docutils literal notranslate"><span class="pre">queries.xml</span></code> file but no
<code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code>, the QL pack resolution behaves as if it defines a QL
pack with no name and a single library path dependency named
<code class="docutils literal notranslate"><span class="pre">legacy-libraries-LANGUAGE</span></code> where <code class="docutils literal notranslate"><span class="pre">LANGUAGE</span></code> is taken from
<code class="docutils literal notranslate"><span class="pre">queries.xml</span></code>. The <code class="docutils literal notranslate"><span class="pre">github/codeql</span></code> repository provides packs with
names following this pattern, which themselves depend on the actual
CodeQL libraries for each language.</p>
<p>When the query directory contains neither a <code class="docutils literal notranslate"><span class="pre">queries.xml</span></code> nor
<code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> file, it is considered to be a QL pack with no name and
no library dependencies. This causes the library path to consist of
<em>only</em> the query directory itself. This is not generally useful,
but it suffices for running toy examples of QL code that don’t
use information from the database.</p>
</section>
<section id="name-resolution">
<h2>Name resolution<a class="headerlink" href="#name-resolution" title="Link to this heading">¶</a></h2>
<p>All modules have three environments that dictate name resolution. These are multimaps of keys to declarations.</p>
<p>The environments are:</p>
<ul class="simple">
<li><p>The <em>module environment</em>, whose keys are module names and whose values are modules.</p></li>
<li><p>The <em>type environment</em>, whose keys are type names and whose values are types.</p></li>
<li><p>The <em>predicate environment</em>, whose keys are pairs of predicate names and arities and whose values are predicates.</p></li>
</ul>
<p>If not otherwise specified, then the environment for a piece of syntax is the same as the environment of its enclosing syntax.</p>
<p>When a key is resolved in an environment, if there is no value for that key, then the program is invalid.</p>
<p>Environments may be combined as follows:</p>
<ul class="simple">
<li><p><em>Union</em>. This takes the union of the entry sets of the two environments.</p></li>
<li><p><em>Overriding union</em>. This takes the union of two environments, but if there are entries for a key in the first map, then no additional entries for that key are included from the second map.</p></li>
</ul>
<p>A <em>definite</em> environment has at most one entry for each key. Resolution is unique in a definite environment.</p>
<section id="global-environments">
<h3>Global environments<a class="headerlink" href="#global-environments" title="Link to this heading">¶</a></h3>
<p>The global module environment is empty.</p>
<p>The global type environment has entries for the primitive types <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">string</span></code>, <code class="docutils literal notranslate"><span class="pre">boolean</span></code>, and <code class="docutils literal notranslate"><span class="pre">date</span></code>, as well as any types defined in the database schema.</p>
<p>The global predicate environment includes all the built-in classless predicates, as well as any extensional predicates declared in the database schema.</p>
<p>The program is invalid if any of these environments is not definite.</p>
</section>
<section id="module-environments">
<h3>Module environments<a class="headerlink" href="#module-environments" title="Link to this heading">¶</a></h3>
<p>For each of modules, types, and predicates, a module <em>imports</em>, <em>declares</em>, and <em>exports</em> an environment. These are defined as follows (with X denoting the type of entity we are currently considering):</p>
<ul class="simple">
<li><p>The <em>imported X environment</em> of a module is defined to be the union of the exported X environments of all the modules which the current module directly imports (see “<a class="reference external" href="#import-directives">Import directives</a>”).</p></li>
<li><p>The <em>declared X environment</em> of a module is the multimap of X declarations in the module itself.</p></li>
<li><p>The <em>exported X environment</em> of a module is the union of the exported X environments of the modules which the current module directly imports (excluding <code class="docutils literal notranslate"><span class="pre">private</span></code> imports), and the declared X environment of the current module (excluding <code class="docutils literal notranslate"><span class="pre">private</span></code> declarations).</p></li>
<li><p>The <em>external X environment</em> of a module is the visible X environment of the enclosing module, if there is one, and otherwise the global X environment.</p></li>
<li><p>The <em>visible X environment</em> is the union of the imported X environment, the declared X environment, and the external X environment.</p></li>
</ul>
<p>The program is invalid if any of these environments is not definite.</p>
<p>Module definitions may be recursive, so the module environments are defined as the least fixed point of the operator given by the above definition. Since all the operations involved are monotonic, this fixed point exists and is unique.</p>
</section>
</section>
<section id="modules">
<h2>Modules<a class="headerlink" href="#modules" title="Link to this heading">¶</a></h2>
<section id="module-definitions">
<h3>Module definitions<a class="headerlink" href="#module-definitions" title="Link to this heading">¶</a></h3>
<p>A QL module definition has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>module ::= annotation* &quot;module&quot; modulename &quot;{&quot; moduleBody &quot;}&quot;

moduleBody ::= (import | predicate | class | module | alias | select)*
</pre></div>
</div>
<p>A module definition extends the current module’s declared module environment with a mapping from the module name to the module definition.</p>
<p>QL files consist of simply a module body without a name and surrounding braces:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ql ::= moduleBody
</pre></div>
</div>
<p>QL files define a module corresponding to the file, whose name is the same as the filename.</p>
</section>
<section id="kinds-of-modules">
<h3>Kinds of modules<a class="headerlink" href="#kinds-of-modules" title="Link to this heading">¶</a></h3>
<p>A module may be:</p>
<ul class="simple">
<li><p>A <em>file module</em>, if it is defined implicitly by a QL file.</p></li>
<li><p>A <em>query module</em>, if it is defined by a QL file.</p></li>
<li><p>A <em>library module</em>, if it is not a query module.</p></li>
</ul>
<p>A query module must contain one or more queries.</p>
</section>
<section id="import-directives">
<h3>Import directives<a class="headerlink" href="#import-directives" title="Link to this heading">¶</a></h3>
<p>An import directive refers to a module identifier:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import ::= annotations &quot;import&quot; importModuleId (&quot;as&quot; modulename)?

qualId ::= simpleId | qualId &quot;.&quot; simpleId

importModuleId ::= qualId
               | importModuleId &quot;::&quot; simpleId
</pre></div>
</div>
<p>An import directive may optionally name the imported module using an <code class="docutils literal notranslate"><span class="pre">as</span></code> declaration. If a name is defined, then the import directive adds to the declared module environment of the current module a mapping from the name to the declaration of the imported module. Otherwise, the current module <em>directly imports</em> the imported module.</p>
</section>
<section id="module-resolution">
<h3>Module resolution<a class="headerlink" href="#module-resolution" title="Link to this heading">¶</a></h3>
<p>Module identifiers are resolved to modules as follows.</p>
<p>For simple identifiers:</p>
<ul class="simple">
<li><p>First, the identifier is resolved as a one-segment qualified identifier (see below).</p></li>
<li><p>If this fails, the identifier is resolved in the current module’s visible module environment.</p></li>
</ul>
<p>For selection identifiers (<code class="docutils literal notranslate"><span class="pre">a::b</span></code>):</p>
<ul class="simple">
<li><p>The qualifier of the selection (<code class="docutils literal notranslate"><span class="pre">a</span></code>) is resolved as a module, and then the name (<code class="docutils literal notranslate"><span class="pre">b</span></code>) is resolved in the exported module environment of the qualifier module.</p></li>
</ul>
<p>For qualified identifiers (<code class="docutils literal notranslate"><span class="pre">a.b</span></code>):</p>
<ul class="simple">
<li><p>Build up a list of <em>candidate search paths</em>, consisting of the current file’s directory, then the <em>query directory</em> of the current file, and finally each of the directories on the <a class="reference external" href="#library-path">library path</a> (in order).</p></li>
<li><p>Determine the first candidate search path that has a <em>matching</em> QLL file for the import directive’s qualified name. A QLL file in a candidate search path is said to match a qualified name if, starting from the candidate search path, there is a subdirectory for each successive qualifier in the qualified name, and the directory named by the final qualifier contains a file whose base name matches the qualified name’s base name, with the addition of the file extension <code class="docutils literal notranslate"><span class="pre">.qll</span></code>. The file and directory names are matched case-sensitively, regardless of whether the filesystem is case-sensitive or not.</p></li>
<li><p>The resolved module is the module defined by the selected candidate search path.</p></li>
</ul>
<p>A qualified module identifier is only valid within an import.</p>
</section>
<section id="module-references-and-active-modules">
<h3>Module references and active modules<a class="headerlink" href="#module-references-and-active-modules" title="Link to this heading">¶</a></h3>
<p>A module <code class="docutils literal notranslate"><span class="pre">M</span></code> <em>references</em> another module <code class="docutils literal notranslate"><span class="pre">N</span></code> if any of the following holds:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">M</span></code> imports <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">M</span></code> defines <code class="docutils literal notranslate"><span class="pre">N</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">N</span></code> is <code class="docutils literal notranslate"><span class="pre">M</span></code>’s enclosing module.</p></li>
</ul>
<p>In a QL program, the <em>active</em> modules are the modules which are referenced transitively by the query module.</p>
</section>
</section>
<section id="types">
<h2>Types<a class="headerlink" href="#types" title="Link to this heading">¶</a></h2>
<p>QL is a typed language. This section specifies the kinds of types available, their attributes, and the syntax for referring to them.</p>
<section id="kinds-of-types">
<h3>Kinds of types<a class="headerlink" href="#kinds-of-types" title="Link to this heading">¶</a></h3>
<p>Types in QL are either <em>primitive</em> types, <em>database</em> types, <em>class</em> types, <em>character</em> types or <em>class domain</em> types.</p>
<p>The primitive types are <code class="docutils literal notranslate"><span class="pre">boolean</span></code>, <code class="docutils literal notranslate"><span class="pre">date</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code>, and <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p>
<p>Database types are supplied as part of the database. Each database type has a <em>name</em>, which is an identifier starting with an at sign (<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>, U+0040) followed by lower-case letter. Database types have some number of <em>base types</em>, which are other database types. In a valid database, the base types relation is non-cyclic.</p>
<p>Class types are defined in QL, in a way specified later in this document (see “<a class="reference external" href="#classes">Classes</a>”). Each class type has a name that is an identifier starting with an upper-case letter. Each class type has one or more base types, which can be any kind of type except a class domain type. A class type may be declared <em>abstract</em>.</p>
<p>Any class in QL has an associated class domain type and an associated character type.</p>
<p>Within the specification the class type for <code class="docutils literal notranslate"><span class="pre">C</span></code> is written <code class="docutils literal notranslate"><span class="pre">C.class</span></code>, the character type is written <code class="docutils literal notranslate"><span class="pre">C.C</span></code> and the domain type is written <code class="docutils literal notranslate"><span class="pre">C.extends</span></code>. However the class type is still named <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
</section>
<section id="type-references">
<h3>Type references<a class="headerlink" href="#type-references" title="Link to this heading">¶</a></h3>
<p>With the exception of class domain types and character types (which cannot be referenced explicitly in QL source), a reference to a type is written as the name of the type. In the case of database types, the name includes the at sign (<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>, U+0040).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>type ::= (moduleId &quot;::&quot;)? classname | dbasetype | &quot;boolean&quot; | &quot;date&quot; | &quot;float&quot; | &quot;int&quot; | &quot;string&quot;

moduleId ::= simpleId | moduleId &quot;::&quot; simpleId
</pre></div>
</div>
<p>A type reference is resolved to a type as follows:</p>
<ul class="simple">
<li><p>If it is a selection identifier (for example, <code class="docutils literal notranslate"><span class="pre">a::B</span></code>), then the qualifier (<code class="docutils literal notranslate"><span class="pre">a</span></code>) is resolved as a module (see “<a class="reference external" href="#module-resolution">Module resolution</a>”). The identifier (<code class="docutils literal notranslate"><span class="pre">B</span></code>) is then resolved in the exported type environment of the qualifier module.</p></li>
<li><p>Otherwise, the identifier is resolved in the current module’s visible type environment.</p></li>
</ul>
</section>
<section id="relations-among-types">
<h3>Relations among types<a class="headerlink" href="#relations-among-types" title="Link to this heading">¶</a></h3>
<p>Types are in a subtype relationship with each other. Type A is a <em>subtype</em> of type B if one of the following is true:</p>
<ul class="simple">
<li><p>A and B are the same type.</p></li>
<li><p>There is some type C, where A is a subtype of C and C is a subtype of B.</p></li>
<li><p>A and B are database types, and B is a base type of A.</p></li>
<li><p>A is the character type of C, and B is the class domain type of C.</p></li>
<li><p>A is a class type, and B is the character type of A.</p></li>
<li><p>A is a class domain type, and B is a base type of the associated class type.</p></li>
<li><p>A is <code class="docutils literal notranslate"><span class="pre">int</span></code> and B is <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
</ul>
<p>Supertypes are the converse of subtypes: A is a <em>supertype</em> of B if B is a subtype of A.</p>
<p>Types A and B are <em>compatible</em> with each other if they either have a common supertype, or they each have some supertype that is a database type.</p>
</section>
<section id="typing-environments">
<h3>Typing environments<a class="headerlink" href="#typing-environments" title="Link to this heading">¶</a></h3>
<p>A <em>typing environment</em> is a finite map of variables to types. Each variable in the map is either an identifier or one of two special symbols: <code class="docutils literal notranslate"><span class="pre">this</span></code>, and <code class="docutils literal notranslate"><span class="pre">result</span></code>.</p>
<p>Most forms of QL syntax have a typing environment that applies to them. That typing environment is determined by the context the syntax appears in.</p>
<p>Note that this is distinct from the type environment, which is a map from type names to types.</p>
</section>
<section id="active-types">
<h3>Active types<a class="headerlink" href="#active-types" title="Link to this heading">¶</a></h3>
<p>In a QL program, the <em>active</em> types are those defined in active modules. In the remainder of this specification, any reference to the types in the program refers only to the active types.</p>
</section>
</section>
<section id="values">
<h2>Values<a class="headerlink" href="#values" title="Link to this heading">¶</a></h2>
<p>Values are the fundamental data that QL programs compute over. This section specifies the kinds of values available in QL, specifies the sorting order for them, and describes how values can be combined into tuples.</p>
<section id="kinds-of-values">
<h3>Kinds of values<a class="headerlink" href="#kinds-of-values" title="Link to this heading">¶</a></h3>
<p>There are six kinds of values in QL: one kind for each of the five primitive types, and <em>entities</em>. Each value has a type.</p>
<p>A boolean value is of type <code class="docutils literal notranslate"><span class="pre">boolean</span></code>, and may have one of two distinct values: <code class="docutils literal notranslate"><span class="pre">true</span></code> or <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p>
<p>A date value is of type <code class="docutils literal notranslate"><span class="pre">date</span></code>. It encodes a time and a date in the Gregorian calendar. Specifically, it includes a year, a month, a day, an hour, a minute, a second, and a millisecond, each of which are integers. The year ranges from -16777216 to 16777215, the month from 0 to 11, the day from 1 to 31, the hour from 0 to 23, the minutes from 0 to 59, the seconds from 0 to 59, and the milliseconds from 0 to 999.</p>
<p>A float value is of type <code class="docutils literal notranslate"><span class="pre">float</span></code>. Each float value is a binary 64-bit floating-point value as specified in IEEE 754.</p>
<p>An integer value is of type <code class="docutils literal notranslate"><span class="pre">int</span></code>. Each value is a 32-bit two’s complement integer.</p>
<p>A string is a finite sequence of 16-bit characters. The characters are interpreted as Unicode code points.</p>
<p>The database includes a number of opaque entity values. Each such value has a type that is one of the database types, and an identifying integer. An entity value is written as the name of its database type followed by its identifying integer in parentheses. For example, <code class="docutils literal notranslate"><span class="pre">&#64;tree(12)</span></code>, <code class="docutils literal notranslate"><span class="pre">&#64;person(16)</span></code>, and <code class="docutils literal notranslate"><span class="pre">&#64;location(38132)</span></code> are entity values. The identifying integers are left opaque to programmers in this specification, so an implementation of QL is free to use some other set of countable labels to identify its entities.</p>
</section>
<section id="ordering">
<h3>Ordering<a class="headerlink" href="#ordering" title="Link to this heading">¶</a></h3>
<p>Values in general do not have a specified ordering. In particular, entity values have no specified ordering with entities or any other values. Primitive values, however, have a total ordering with other primitive values in the same type. Primitives types and their subtypes are said to be <em>orderable</em>.</p>
<p>For booleans, <code class="docutils literal notranslate"><span class="pre">false</span></code> is ordered before <code class="docutils literal notranslate"><span class="pre">true</span></code>.</p>
<p>For dates, the ordering is chronological.</p>
<p>For floats, the ordering is as specified in IEEE 754 when one exists, except that NaN is considered equal to itself and is ordered after all other floats, and negative zero is considered to be strictly less than positive zero.</p>
<p>For integers, the ordering is as for two’s complement integers.</p>
<p>For strings, the ordering is lexicographic.</p>
</section>
<section id="tuples">
<h3>Tuples<a class="headerlink" href="#tuples" title="Link to this heading">¶</a></h3>
<p>Values can be grouped into tuples in two different ways.</p>
<p>An <em>ordered tuple</em> is a finite, ordered sequence of values. For example, (<code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;three&quot;</span></code>) is an ordered sequence of two integers and a string.</p>
<p>A <em>named tuple</em> is a finite map of variables to values. Each variable in a named tuple is either an identifier, <code class="docutils literal notranslate"><span class="pre">this</span></code>, or <code class="docutils literal notranslate"><span class="pre">result</span></code>.</p>
<p>A <em>variable declaration list</em> provides a sequence of variables and a type for each one:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>var_decls ::= (var_decl (&quot;,&quot; var_decl)*)?
var_decl ::= type simpleId
</pre></div>
</div>
<p>A valid variable declaration list must not include two declarations with the same variable name. Moreover, if the declaration has a typing environment that applies, it must not use a variable name that is already present in that typing environment.</p>
<p>An <em>extension</em> of a named tuple for a given variable declaration list is a named tuple that additionally maps each variable in the list to a value. The value mapped by each new variable must be in the type that is associated with that variable in the given list; see “<a class="reference external" href="#the-store">The store</a>” for the definition of a value being in a type.</p>
</section>
</section>
<section id="the-store">
<h2>The store<a class="headerlink" href="#the-store" title="Link to this heading">¶</a></h2>
<p>QL programs evaluate in the context of a <em>store</em>. This section specifies several definitions related to the store.</p>
<p>A <em>fact</em> is a predicate or type along with a named tuple. A fact is written as the predicate name or type name followed immediately by the tuple. Here are some examples of facts:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>successor(fst: 0, snd:1)
Tree.toString(this:@method_tree(12), result:&quot;def println&quot;)
Location.class(this:@location(43))
Location.getURL(this: @location(43), result:&quot;file:///etc/hosts:2:0:2:12&quot;)
</pre></div>
</div>
<p>A <em>store</em> is a mutable set of facts. The store can be mutated by adding more facts to it.</p>
<p>An named tuple <em>directly satisfies</em> a predicate or type with a given tuple if there is a fact in the store with the given tuple and predicate or type.</p>
<p>A value <code class="docutils literal notranslate"><span class="pre">v</span></code> is in a type <code class="docutils literal notranslate"><span class="pre">t</span></code> under any of the following conditions:</p>
<ul class="simple">
<li><p>The type of <code class="docutils literal notranslate"><span class="pre">v</span></code> is <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">t</span></code> is a primitive type.</p></li>
<li><p>There is a tuple with <code class="docutils literal notranslate"><span class="pre">this</span></code> component <code class="docutils literal notranslate"><span class="pre">v</span></code> that directly satisfies <code class="docutils literal notranslate"><span class="pre">t</span></code>.</p></li>
</ul>
<p>An ordered tuple <code class="docutils literal notranslate"><span class="pre">v</span></code> <em>directly satisfies</em> a predicate with a given tuple if there is a fact in the store with the given predicate and a named tuple <code class="docutils literal notranslate"><span class="pre">v'</span></code>
such that taking the ordered tuple formed by the <code class="docutils literal notranslate"><span class="pre">this</span></code> component of <code class="docutils literal notranslate"><span class="pre">v'</span></code> followed by the component for each argument equals the ordered tuple.</p>
<p>An ordered tuple <em>satisfies a predicate</em> <code class="docutils literal notranslate"><span class="pre">p</span></code> under the following circumstances. If <code class="docutils literal notranslate"><span class="pre">p</span></code> is not a member predicate, then the tuple satisfies the predicate whenever the named tuple satisfies the tuple.</p>
<p>Otherwise, the tuple must be the tuple of a fact in the store with predicate <code class="docutils literal notranslate"><span class="pre">q</span></code>, where <code class="docutils literal notranslate"><span class="pre">q</span></code> shares a root definition with <code class="docutils literal notranslate"><span class="pre">p</span></code>. The <cite>first</cite> element of the tuple must be in the type before the dot in <code class="docutils literal notranslate"><span class="pre">q</span></code>, and there must be no other predicate that overrides <code class="docutils literal notranslate"><span class="pre">q</span></code> such that this is true (see “<a class="reference external" href="#classes">Classes</a>” for details on overriding and root definitions).</p>
<p>An ordered tuple <code class="docutils literal notranslate"><span class="pre">(a0,</span> <span class="pre">an)</span></code> satisfies the <code class="docutils literal notranslate"><span class="pre">+</span></code> closure of a predicate if there is a sequence of binary tuples <code class="docutils literal notranslate"><span class="pre">(a0,</span> <span class="pre">a1)</span></code>, <code class="docutils literal notranslate"><span class="pre">(a1,</span> <span class="pre">a2)</span></code>, …, <code class="docutils literal notranslate"><span class="pre">(an-1,</span> <span class="pre">an)</span></code> that all satisfy the predicate. An ordered tuple <code class="docutils literal notranslate"><span class="pre">(a,</span> <span class="pre">b)</span></code> satisfies the <code class="docutils literal notranslate"><span class="pre">*</span></code> closure of a predicate if it either satisfies the <code class="docutils literal notranslate"><span class="pre">+</span></code> closure, or if <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are the same, and if moreover they are in each argument type of the predicate.</p>
</section>
<section id="lexical-syntax">
<h2>Lexical syntax<a class="headerlink" href="#lexical-syntax" title="Link to this heading">¶</a></h2>
<p>QL and QLL files contain a sequence of <em>tokens</em> that are encoded as Unicode text. This section describes the tokenization algorithm, the kinds of available tokens, and their representation in Unicode.</p>
<p>Some kinds of tokens have an identifier given in parentheses in the section title. That identifier, if present, is a terminal used in grammar productions later in the specification. Additionally, the “<a class="reference external" href="#identifiers">Identifiers</a>” section gives several kinds of identifiers, each of which has its own grammar terminal.</p>
<section id="tokenization">
<h3>Tokenization<a class="headerlink" href="#tokenization" title="Link to this heading">¶</a></h3>
<p>Source files are interpreted as a sequence of tokens according to the following algorithm. First, the longest-match rule, described below, is applied starting at the beginning of the file. Second, all whitespace tokens and comments are discarded from the sequence.</p>
<p>The longest-match rule is applied as follows. The first token in the file is the longest token consisting of a contiguous sequence of characters at the beginning of the file. The next token after any other token is the longest token consisting of contiguous characters that immediately follow any previous token.</p>
<p>If the file cannot be tokenized in its entirety, then the file is invalid.</p>
</section>
<section id="whitespace">
<h3>Whitespace<a class="headerlink" href="#whitespace" title="Link to this heading">¶</a></h3>
<p>A whitespace token is a sequence of spaces (U+0020), tabs (U+0009), carriage returns (U+000D), and line feeds (U+000A).</p>
</section>
<section id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Link to this heading">¶</a></h3>
<p>There are two kinds of comments in QL: one-line and multiline.</p>
<p>A one-line comment is two slash characters (<code class="docutils literal notranslate"><span class="pre">/</span></code>, U+002F) followed by any sequence of characters other than line feeds (U+000A) and carriage returns (U+000D). Here is an example of a one-line comment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>// This is a comment
</pre></div>
</div>
<p>A multiline comment is a <em>comment start</em>, followed by a <em>comment body</em>, followed by a <em>comment end</em>. A comment start is a slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>, U+002F) followed by an asterisk (<code class="docutils literal notranslate"><span class="pre">*</span></code>, U+002A), and a comment end is an asterisk followed by a slash. A comment body is any sequence of characters that does not include a comment end and does not start with an asterisk. Here is an example multiline comment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/*
  It was the best of code.
  It was the worst of code.
  It had a multiline comment.
*/
</pre></div>
</div>
</section>
<section id="qldoc-qldoc">
<h3>QLDoc (qldoc)<a class="headerlink" href="#qldoc-qldoc" title="Link to this heading">¶</a></h3>
<p>A QLDoc comment is a <em>qldoc comment start</em>, followed by a <em>qldoc comment body</em>, followed by a <em>qldoc comment end</em>. A comment start is a slash (<code class="docutils literal notranslate"><span class="pre">/</span></code>, U+002F) followed by two asterisks (<code class="docutils literal notranslate"><span class="pre">*</span></code>, U+002A), and a qldoc comment end is an asterisk followed by a slash. A qldoc comment body is any sequence of characters that does not include a comment end. Here is an example QLDoc comment:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>/**
  It was the best of code.
  It was the worst of code.
  It had a qldoc comment.
*/
</pre></div>
</div>
<p>The “content” of a QLDoc comment is the comment body of the comment, omitting the initial <code class="docutils literal notranslate"><span class="pre">/**</span></code>, the trailing <code class="docutils literal notranslate"><span class="pre">*/</span></code>, and the leading whitespace followed by <code class="docutils literal notranslate"><span class="pre">*</span></code> on each internal line.</p>
<p>For more information about how the content is interpreted, see “<a class="reference external" href="#qldoc">QLDoc</a>” below.</p>
</section>
<section id="keywords">
<h3>Keywords<a class="headerlink" href="#keywords" title="Link to this heading">¶</a></h3>
<p>The following sequences of characters are keyword tokens:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>and
any
as
asc
avg
boolean
by
class
concat
count
date
desc
else
exists
extends
false
float
forall
forex
from
if
implies
import
in
instanceof
int
max
min
module
newtype
none
not
or
order
predicate
rank
result
select
strictconcat
strictcount
strictsum
string
sum
super
then
this
true
unique
where
</pre></div>
</div>
</section>
<section id="operators">
<h3>Operators<a class="headerlink" href="#operators" title="Link to this heading">¶</a></h3>
<p>The following sequences of characters are operator tokens:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;
&lt;=
=
&gt;
&gt;=
_
-
,
;
!=
/
.
..
(
)
[
]
{
}
*
%
+
|
</pre></div>
</div>
</section>
<section id="identifiers">
<h3>Identifiers<a class="headerlink" href="#identifiers" title="Link to this heading">¶</a></h3>
<p>An identifier is an optional “&#64;” sign (U+0040) followed by a sequence of identifier characters. Identifier characters are lower-case ASCII letters (<code class="docutils literal notranslate"><span class="pre">a</span></code> through <code class="docutils literal notranslate"><span class="pre">z</span></code>, U+0061 through U+007A), upper-case ASCII letters (<code class="docutils literal notranslate"><span class="pre">A</span></code> through <code class="docutils literal notranslate"><span class="pre">Z</span></code>, U+0041 through U+005A), decimal digits (<code class="docutils literal notranslate"><span class="pre">0</span></code> through <code class="docutils literal notranslate"><span class="pre">9</span></code>, U+0030 through U+0039), and underscores (<code class="docutils literal notranslate"><span class="pre">_</span></code>, U+005F). The first character of an identifier other than any “&#64;” sign must be a letter.</p>
<p>An identifier cannot have the same sequence of characters as a keyword, nor can it be an “&#64;” sign followed by a keyword.</p>
<p>Here are some examples of identifiers:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>width
Window_width
window5000_mark_II
@expr
</pre></div>
</div>
<p>There are several kinds of identifiers:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lowerId</span></code>: an identifier that starts with a lower-case letter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">upperId</span></code>: an identifier that starts with an upper-case letter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atLowerId</span></code>: an identifier that starts with an “&#64;” sign and then a lower-case letter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">atUpperId</span></code>: an identifier that starts with an “&#64;” sign and then an upper-case letter.</p></li>
</ul>
<p>Identifiers are used in following syntactic constructs:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>simpleId      ::= lowerId | upperId
modulename    ::= simpleId
classname     ::= upperId
dbasetype     ::= atLowerId
predicateRef  ::= (moduleId &quot;::&quot;)? literalId
predicateName ::= lowerId
varname       ::= simpleId
literalId     ::= lowerId | atLowerId
</pre></div>
</div>
</section>
<section id="integer-literals-int">
<h3>Integer literals (int)<a class="headerlink" href="#integer-literals-int" title="Link to this heading">¶</a></h3>
<p>An integer literal is a possibly negated sequence of decimal digits (<code class="docutils literal notranslate"><span class="pre">0</span></code> through <code class="docutils literal notranslate"><span class="pre">9</span></code>, U+0030 through U+0039). Here are some examples of integer literals:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0
42
123
-2147483648
</pre></div>
</div>
</section>
<section id="float-literals-float">
<h3>Float literals (float)<a class="headerlink" href="#float-literals-float" title="Link to this heading">¶</a></h3>
<p>A floating-point literals is a possibly negated two non-negative integers literals separated by a dot (<code class="docutils literal notranslate"><span class="pre">.</span></code>, U+002E). Here are some examples of float literals:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.5
2.0
123.456
-100.5
</pre></div>
</div>
</section>
<section id="string-literals-string">
<h3>String literals (string)<a class="headerlink" href="#string-literals-string" title="Link to this heading">¶</a></h3>
<p>A string literal denotes a sequence of characters. It begins and ends with a double quote character (U+0022). In between the double quotes are a sequence of string character indicators, each of which indicates one character that should be included in the string. The string character indicators are as follows.</p>
<ul class="simple">
<li><p>Any character other than a double quote (U+0022), backslash (U+005C), line feed (U+000A), carriage return (U+000D), or tab (U+0009). Such a character indicates itself.</p></li>
<li><p>A backslash (U+005C) followed by one of the following characters:</p>
<ul>
<li><p>Another backslash (U+005C), in which case a backslash character is indicated.</p></li>
<li><p>A double quote (U+0022), in which case a double quote is indicated.</p></li>
<li><p>The letter “n” (U+006E), in which case a line feed (U+000A) is indicated.</p></li>
<li><p>The letter “r” (U+0072), in which case a carriage return (U+000D) is indicated.</p></li>
<li><p>The letter “t” (U+0074), in which case a tab (U+0009) is indicated.</p></li>
</ul>
</li>
</ul>
<p>Here are some examples of string literals:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&quot;hello&quot;
&quot;He said, \&quot;Logic clearly dictates that the needs of the many...\&quot;&quot;
</pre></div>
</div>
</section>
</section>
<section id="annotations">
<h2>Annotations<a class="headerlink" href="#annotations" title="Link to this heading">¶</a></h2>
<p>Various kinds of syntax can have <em>annotations</em> applied to them. Annotations are as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>annotations ::= annotation*

annotation ::= simpleAnnotation | argsAnnotation

simpleAnnotation ::= &quot;abstract&quot;
                 |   &quot;cached&quot;
                 |   &quot;external&quot;
                 |   &quot;final&quot;
                 |   &quot;transient&quot;
                 |   &quot;library&quot;
                 |   &quot;private&quot;
                 |   &quot;deprecated&quot;
                 |   &quot;override&quot;
                 |   &quot;query&quot;

argsAnnotation ::= &quot;pragma&quot; &quot;[&quot; (&quot;inline&quot; | &quot;noinline&quot; | &quot;nomagic&quot; | &quot;noopt&quot;) &quot;]&quot;
               |   &quot;language&quot; &quot;[&quot; &quot;monotonicAggregates&quot; &quot;]&quot;
               |   &quot;bindingset&quot; &quot;[&quot; (variable ( &quot;,&quot; variable)*)? &quot;]&quot;
</pre></div>
</div>
<p>Each simple annotation adds a same-named attribute to the syntactic entity it precedes. For example, if a class is preceded by the <code class="docutils literal notranslate"><span class="pre">abstract</span></code> annotation, then the class is said to be abstract.</p>
<p>A valid annotation list may not include the same simple annotation more than once, or the same parameterized annotation more than once with the same arguments. However, it may include the same parameterized annotation more than once with different arguments.</p>
<section id="simple-annotations">
<h3>Simple annotations<a class="headerlink" href="#simple-annotations" title="Link to this heading">¶</a></h3>
<p>The following table summarizes the syntactic constructs which can be marked with each annotation in a valid program; for example, an <code class="docutils literal notranslate"><span class="pre">abstract</span></code> annotation preceding a character is invalid.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Annotation</p></th>
<th class="head"><p>Classes</p></th>
<th class="head"><p>Characters</p></th>
<th class="head"><p>Member predicates</p></th>
<th class="head"><p>Non-member predicates</p></th>
<th class="head"><p>Imports</p></th>
<th class="head"><p>Fields</p></th>
<th class="head"><p>Modules</p></th>
<th class="head"><p>Aliases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abstract</span></code></p></td>
<td><p>yes</p></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cached</span></code></p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">external</span></code></p></td>
<td></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">final</span></code></p></td>
<td><p>yes</p></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">transient</span></code></p></td>
<td></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">library</span></code></p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">private</span></code></p></td>
<td><p>yes</p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">deprecated</span></code></p></td>
<td><p>yes</p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">override</span></code></p></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">query</span></code></p></td>
<td></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td><p>yes</p></td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">library</span></code> annotation is only usable within a QLL file, not a QL file.</p>
<p>Annotations on aliases apply to the name introduced by the alias. An alias may, for example, have different privacy to the name it aliases.</p>
</section>
<section id="parameterized-annotations">
<h3>Parameterized annotations<a class="headerlink" href="#parameterized-annotations" title="Link to this heading">¶</a></h3>
<p>Parameterized annotations take some additional arguments.</p>
<p>The parameterized annotation <code class="docutils literal notranslate"><span class="pre">pragma</span></code> supplies compiler pragmas, and may be applied in various contexts depending on the pragma in question.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pragma</p></th>
<th class="head"><p>Classes</p></th>
<th class="head"><p>Characters</p></th>
<th class="head"><p>Member predicates</p></th>
<th class="head"><p>Non-member predicates</p></th>
<th class="head"><p>Imports</p></th>
<th class="head"><p>Fields</p></th>
<th class="head"><p>Modules</p></th>
<th class="head"><p>Aliases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">inline</span></code></p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">noinline</span></code></p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nomagic</span></code></p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">noopt</span></code></p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>The parameterized annotation <code class="docutils literal notranslate"><span class="pre">language</span></code> supplies language pragmas which change the behavior of the language. Language pragmas apply at the scope level, and are inherited by nested scopes.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pragma</p></th>
<th class="head"><p>Classes</p></th>
<th class="head"><p>Characters</p></th>
<th class="head"><p>Member predicates</p></th>
<th class="head"><p>Non-member predicates</p></th>
<th class="head"><p>Imports</p></th>
<th class="head"><p>Fields</p></th>
<th class="head"><p>Modules</p></th>
<th class="head"><p>Aliases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">monotonicAggregates</span></code></p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td><p>yes</p></td>
<td></td>
</tr>
</tbody>
</table>
<p>A binding set for a predicate is a subset of the predicate’s arguments such that if those arguments are bound (restricted to a finite range of values), then all of the predicate’s arguments are bound.</p>
<p>The parameterized annotation <code class="docutils literal notranslate"><span class="pre">bindingset</span></code> can be applied to a predicate (see “<a class="reference external" href="#non-member-predicates">Non-member predicates</a>” and “<a class="reference external" href="#members">Members</a>”) to specify a binding set.</p>
<p>This annotation accepts a (possibly empty) list of variable names as parameters. The named variables must all be arguments of the predicate, possibly including <code class="docutils literal notranslate"><span class="pre">this</span></code> for characteristic predicates and member predicates, and <code class="docutils literal notranslate"><span class="pre">result</span></code> for predicates that yield a result.</p>
<p>In the default case where no binding sets are specified by the user, then it is assumed that there is precisely one, empty binding set - that is, the body of the predicate must bind all the arguments.</p>
<p>Binding sets are checked by the QL compiler in the following way:</p>
<ol class="arabic simple">
<li><p>It assumes that all variables mentioned in the binding set are bound.</p></li>
<li><p>It checks that, under this assumption, all the remaining argument variables are bound by the predicate body.</p></li>
</ol>
<p>A predicate may have several different binding sets, which can be stated by using multiple <code class="docutils literal notranslate"><span class="pre">bindingset</span></code> annotations on the same predicate.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Pragma</p></th>
<th class="head"><p>Classes</p></th>
<th class="head"><p>Characters</p></th>
<th class="head"><p>Member predicates</p></th>
<th class="head"><p>Non-member predicates</p></th>
<th class="head"><p>Imports</p></th>
<th class="head"><p>Fields</p></th>
<th class="head"><p>Modules</p></th>
<th class="head"><p>Aliases</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bindingset</span></code></p></td>
<td></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td><p>yes</p></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="qldoc">
<h2>QLDoc<a class="headerlink" href="#qldoc" title="Link to this heading">¶</a></h2>
<p>QLDoc is used for documenting QL entities and bindings. QLDoc that is used as part of the
declaration is said to be declared.</p>
<section id="ambiguous-qldoc">
<h3>Ambiguous QLDoc<a class="headerlink" href="#ambiguous-qldoc" title="Link to this heading">¶</a></h3>
<p>If QLDoc can be parsed as part of a file module or as part of the first declaration in the file then
it is parsed as part of the first declaration.</p>
</section>
<section id="inheriting-qldoc">
<h3>Inheriting QLDoc<a class="headerlink" href="#inheriting-qldoc" title="Link to this heading">¶</a></h3>
<p>If no QLDoc is provided then it may be inherited.</p>
<p>In the case of an alias then it may be inherited from the right-hand side of the alias.</p>
<p>In the case of a member predicate we collect all member predicates that it overrides with declared QLDoc. If there is a member predicate in that collection that
overrides every other member predicate in that collection, then the QLDoc of that member predicate is used as the QLDoc.</p>
<p>In the case of a field we collect all fields that it overrides with declared QLDoc. If there is a field in that collection that
overrides every other field in that collection, then the QLDoc of that field is used as the QLDoc.</p>
</section>
<section id="content">
<h3>Content<a class="headerlink" href="#content" title="Link to this heading">¶</a></h3>
<p>The content of a QLDoc comment is interpreted as <a class="reference external" href="https://commonmark.org/">CommonMark</a>, with the following extensions:</p>
<ul class="simple">
<li><p>Automatic interpretation of links and email addresses.</p></li>
<li><p>Use of appropriate characters for ellipses, dashes, apostrophes, and quotes.</p></li>
</ul>
<p>The content of a QLDoc comment may contain metadata tags as follows:</p>
<p>The tag begins with any number of whitespace characters, followed by an <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> sign. At this point there may be any number of non-whitespace characters, which form the key of the tag. Then, a single whitespace character which separates the key from the value. The value of the tag is formed by the remainder of the line, and any subsequent lines until another <code class="docutils literal notranslate"><span class="pre">&#64;</span></code> tag is seen, or the end of the content is reached. Any sequence of consecutive whitespace characters in the value are replaced by a single space.</p>
</section>
<section id="metadata">
<h3>Metadata<a class="headerlink" href="#metadata" title="Link to this heading">¶</a></h3>
<p>If the query file starts with whitespace followed by a QLDoc comment, then the tags from that QLDoc comment form the query metadata.</p>
</section>
</section>
<section id="top-level-entities">
<h2>Top-level entities<a class="headerlink" href="#top-level-entities" title="Link to this heading">¶</a></h2>
<p>Modules include five kinds of top-level entity: predicates, classes, modules, aliases, and select clauses.</p>
<section id="non-member-predicates">
<h3>Non-member predicates<a class="headerlink" href="#non-member-predicates" title="Link to this heading">¶</a></h3>
<p>A <em>predicate</em> is declared as a sequence of annotations, a head, and an optional body:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>predicate ::= qldoc? annotations head optbody
</pre></div>
</div>
<p>A predicate definition adds a mapping from the predicate name and arity to the predicate declaration to the current module’s declared predicate environment.</p>
<p>When a predicate is a top-level clause in a module, it is called a non-member predicate. See below for “<a class="reference external" href="#member-predicates">Member predicates</a>.”</p>
<p>A valid non-member predicate can be annotated with <code class="docutils literal notranslate"><span class="pre">cached</span></code>, <code class="docutils literal notranslate"><span class="pre">deprecated</span></code>, <code class="docutils literal notranslate"><span class="pre">external</span></code>, <code class="docutils literal notranslate"><span class="pre">transient</span></code>, <code class="docutils literal notranslate"><span class="pre">private</span></code>, and <code class="docutils literal notranslate"><span class="pre">query</span></code>. Note, the <code class="docutils literal notranslate"><span class="pre">transient</span></code> annotation can only be applied if the non-member predicate is also annotated with <code class="docutils literal notranslate"><span class="pre">external</span></code>.</p>
<p>The head of the predicate gives a name, an optional <em>result type</em>, and a sequence of variables declarations that are <em>arguments</em>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>head ::= (&quot;predicate&quot; | type) predicateName &quot;(&quot; var_decls &quot;)&quot;
</pre></div>
</div>
<p>The body of a predicate is of one of three forms:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>optbody ::= &quot;;&quot;
        |  &quot;{&quot; formula &quot;}&quot;
        |  &quot;=&quot; literalId &quot;(&quot; (predicateRef &quot;/&quot; int (&quot;,&quot; predicateRef &quot;/&quot; int)*)? &quot;)&quot; &quot;(&quot; (exprs)? &quot;)&quot;
</pre></div>
</div>
<p>In the first form, with just a semicolon, the predicate is said to not have a body. In the second form, the body of the predicate is the given formula (see “<a class="reference external" href="#formulas">Formulas</a>”). In the third form, the body is a higher-order relation.</p>
<p>A valid non-member predicate must have a body, either a formula or a higher-order relation, unless it is external, in which case it must not have a body.</p>
<p>The typing environment for the body of the formula, if present, maps the variables in the head of the predicate to their associated types. If the predicate has a result type, then the typing environment also maps <code class="docutils literal notranslate"><span class="pre">result</span></code> to the result type.</p>
</section>
<section id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Link to this heading">¶</a></h3>
<p>A class definition has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>class ::= qldoc? annotations &quot;class&quot; classname &quot;extends&quot; type (&quot;,&quot; type)* &quot;{&quot; member* &quot;}&quot;
</pre></div>
</div>
<p>The identifier following the <code class="docutils literal notranslate"><span class="pre">class</span></code> keyword is the name of the class.</p>
<p>The types specified after the <code class="docutils literal notranslate"><span class="pre">extends</span></code> keyword are the <em>base types</em> of the class.</p>
<p>A class domain type is said to <em>inherit</em> from the base types of the associated class type, a character type is said to <em>inherit</em> from its associated class domain type and a class type is said to <em>inherit</em> from its associated character type. In addition, inheritance is transitive: If a type <code class="docutils literal notranslate"><span class="pre">A</span></code> inherits from a type <code class="docutils literal notranslate"><span class="pre">B</span></code>, and <code class="docutils literal notranslate"><span class="pre">B</span></code> inherits from a type <code class="docutils literal notranslate"><span class="pre">C</span></code>, then <code class="docutils literal notranslate"><span class="pre">A</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p>
<p>A class adds a mapping from the class name to the class declaration to the current module’s declared type environment.</p>
<p>A valid class can be annotated with <code class="docutils literal notranslate"><span class="pre">abstract</span></code>, <code class="docutils literal notranslate"><span class="pre">final</span></code>, <code class="docutils literal notranslate"><span class="pre">library</span></code>, and <code class="docutils literal notranslate"><span class="pre">private</span></code>. Any other annotation renders the class invalid.</p>
<p>A valid class may not inherit from a final class, from itself, or from more than one primitive type.</p>
</section>
<section id="class-environments">
<h3>Class environments<a class="headerlink" href="#class-environments" title="Link to this heading">¶</a></h3>
<p>For each of member predicates and fields a class <em>inherits</em> and <em>declares</em>, and <em>exports</em> an environment. These are defined as follows (with X denoting the type of entity we are currently considering):</p>
<ul class="simple">
<li><p>The <em>inherited X environment</em> of a class is the union of the exported X environments of types it inherits from, excluding any elements that are <code class="docutils literal notranslate"><span class="pre">overridden</span></code> by another element.</p></li>
<li><p>The <em>declared X environment</em> of a class is the multimap of X declarations in the class itself.</p></li>
<li><p>The <em>exported X environment</em> of a class is the overriding union of its declared X environment (excluding <code class="docutils literal notranslate"><span class="pre">private</span></code> declaration entries) with its inherited X environment.</p></li>
<li><p>The <em>visible X environment</em> is the overriding union of the declared X environment and the inherited X environment.</p></li>
</ul>
<p>The program is invalid if any of these environments is not definite.</p>
<p>For each of member predicates and fields a domain type <em>exports</em> an environment. This is the union of the exported <code class="docutils literal notranslate"><span class="pre">X</span></code> environments of types the class inherits from, excluding any elements that are <code class="docutils literal notranslate"><span class="pre">overridden</span></code> by another element.</p>
</section>
<section id="members">
<h3>Members<a class="headerlink" href="#members" title="Link to this heading">¶</a></h3>
<p>Each member of a class is either a <em>character</em>, a predicate, or a field:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>member ::= character | predicate | field
character ::= qldoc? annotations classname &quot;(&quot; &quot;)&quot; &quot;{&quot; formula &quot;}&quot;
field ::= qldoc? annotations var_decl &quot;;&quot;
</pre></div>
</div>
<section id="characters">
<h4>Characters<a class="headerlink" href="#characters" title="Link to this heading">¶</a></h4>
<p>A valid character must have the same name as the name of the class. A valid class has at most one character provided in the source code.</p>
<p>A valid character can be annotated with <code class="docutils literal notranslate"><span class="pre">cached</span></code>. Any other annotation renders the character invalid.</p>
</section>
<section id="member-predicates">
<h4>Member predicates<a class="headerlink" href="#member-predicates" title="Link to this heading">¶</a></h4>
<p>A predicate that is a member of a class is called a <em>member predicate</em>. The name of the predicate is the identifier just before the open parenthesis.</p>
<p>A member predicate adds a mapping from the predicate name and arity to the predicate declaration in the class’s declared member predicate environment.</p>
<p>A valid member predicate can be annotated with <code class="docutils literal notranslate"><span class="pre">abstract</span></code>, <code class="docutils literal notranslate"><span class="pre">cached</span></code>, <code class="docutils literal notranslate"><span class="pre">final</span></code>, <code class="docutils literal notranslate"><span class="pre">private</span></code>, <code class="docutils literal notranslate"><span class="pre">deprecated</span></code>, and <code class="docutils literal notranslate"><span class="pre">override</span></code>.</p>
<p>If a type is provided before the name of the member predicate, then that type is the <em>result type</em> of the predicate. Otherwise, the predicate has no result type. The types of the variables in the <code class="docutils literal notranslate"><span class="pre">var_decls</span></code> are called the predicate’s <em>argument types</em>.</p>
<p>A member predicate <code class="docutils literal notranslate"><span class="pre">p</span></code> with enclosing class <code class="docutils literal notranslate"><span class="pre">C</span></code> <em>overrides</em> a member predicate <code class="docutils literal notranslate"><span class="pre">p'</span></code> with enclosing class <code class="docutils literal notranslate"><span class="pre">D</span></code> when <code class="docutils literal notranslate"><span class="pre">C</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">D</span></code>, <code class="docutils literal notranslate"><span class="pre">p'</span></code> is visible in <code class="docutils literal notranslate"><span class="pre">C</span></code>, and both <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">p'</span></code> have the same name and the same arity. An overriding predicate must have the same sequence of argument types as any predicates which it overrides, otherwise the program is invalid.</p>
<p>Member predicates have one or more <em>root definitions</em>. If a member predicate overrides no other member predicate, then it is its own root definition. Otherwise, its root definitions are those of any member predicate that it overrides.</p>
<p>A valid member predicate must have a body unless it is abstract or external, in which case it must not have a body.</p>
<p>A valid member predicate must override another member predicate if it is annotated override.</p>
<p>When member predicate <code class="docutils literal notranslate"><span class="pre">p</span></code> overrides member predicate <code class="docutils literal notranslate"><span class="pre">q</span></code>, either <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">q</span></code> must both have a result type, or neither of them may have a result type. If they do have result types, then the result type of <code class="docutils literal notranslate"><span class="pre">p</span></code> must be a subtype of the result type of <code class="docutils literal notranslate"><span class="pre">q</span></code>. <code class="docutils literal notranslate"><span class="pre">q</span></code> may not be a final predicate. If <code class="docutils literal notranslate"><span class="pre">p</span></code> is abstract, then <code class="docutils literal notranslate"><span class="pre">q</span></code> must be as well.</p>
<p>A class may not inherit from a class with an abstract member predicate unless it either includes a member predicate overriding that abstract predicate, or it inherits from another class that does.</p>
<p>A valid class must include a non-private predicate named <code class="docutils literal notranslate"><span class="pre">toString</span></code> with no arguments and a result type of <code class="docutils literal notranslate"><span class="pre">string</span></code>, or it must inherit from a class that does.</p>
<p>A valid class may not inherit from two different classes that include a predicate with the same name and number of arguments, unless either one of the predicates overrides the other, or the class defines a predicate that overrides both of them.</p>
<p>The typing environment for a member predicate or character is the same as if it were a non-member predicate, except that it additionally maps <code class="docutils literal notranslate"><span class="pre">this</span></code> to a type and also maps any fields on a class to a type. If the member is a character, then the typing environment maps <code class="docutils literal notranslate"><span class="pre">this</span></code> to the class domain type of the class. Otherwise, it maps <code class="docutils literal notranslate"><span class="pre">this</span></code> to the class type of the class itself.
The typing environment also maps any field to the type of the field.</p>
</section>
<section id="fields">
<h4>Fields<a class="headerlink" href="#fields" title="Link to this heading">¶</a></h4>
<p>A field declaration introduces a mapping from the field name to the field declaration in the class’s declared field environment.</p>
<p>A field <code class="docutils literal notranslate"><span class="pre">f</span></code> with enclosing class <code class="docutils literal notranslate"><span class="pre">C</span></code> <em>overrides</em> a field <code class="docutils literal notranslate"><span class="pre">f'</span></code> with enclosing class <code class="docutils literal notranslate"><span class="pre">D</span></code> when <code class="docutils literal notranslate"><span class="pre">f</span></code> is annotated <code class="docutils literal notranslate"><span class="pre">override</span></code>, <code class="docutils literal notranslate"><span class="pre">C</span></code> inherits from <code class="docutils literal notranslate"><span class="pre">D</span></code>, <code class="docutils literal notranslate"><span class="pre">p'</span></code> is visible in <code class="docutils literal notranslate"><span class="pre">C</span></code>, and both <code class="docutils literal notranslate"><span class="pre">p</span></code> and <code class="docutils literal notranslate"><span class="pre">p'</span></code> have the same name.</p>
<p>A valid class may not inherit from two different classes that include a field with the same name, unless either one of the fields overrides the other, or the class defines a field that overrides both of them.</p>
<p>A valid field must override another field if it is annotated <code class="docutils literal notranslate"><span class="pre">override</span></code>.</p>
<p>When field <code class="docutils literal notranslate"><span class="pre">f</span></code> overrides field <code class="docutils literal notranslate"><span class="pre">g</span></code> the type of <code class="docutils literal notranslate"><span class="pre">f</span></code> must be a subtype of the type of <code class="docutils literal notranslate"><span class="pre">g</span></code>. <code class="docutils literal notranslate"><span class="pre">f</span></code> may not be a final field.</p>
</section>
</section>
<section id="select-clauses">
<h3>Select clauses<a class="headerlink" href="#select-clauses" title="Link to this heading">¶</a></h3>
<p>A QL file may include at most one <em>select clause</em>. That select clause has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>select ::= (&quot;from&quot; var_decls)? (&quot;where&quot; formula)? &quot;select&quot; select_exprs (&quot;order&quot; &quot;by&quot; orderbys)?
</pre></div>
</div>
<p>A valid QLL file may not include any select clauses.</p>
<p>A select clause is considered to be a declaration of an anonymous predicate whose arguments correspond to the select expressions of the select clause.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">from</span></code> keyword, if present, is followed by the <em>variables</em> of the formula. Otherwise, the select clause has no variables.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">where</span></code> keyword, if present, is followed by the <em>formula</em> of the select clause. Otherwise, the select clause has no formula.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">select</span></code> keyword is followed by a number of <em>select expressions</em>. Select expressions have the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>as_exprs ::= as_expr (&quot;,&quot; as_expr)*
as_expr ::= expr (&quot;as&quot; simpleId)?
</pre></div>
</div>
<p>The keyword <code class="docutils literal notranslate"><span class="pre">as</span></code> gives a <em>label</em> to the select expression it is part of. No two select expressions may have the same label. No expression label may be the same as one of the variables of the select clause.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">order</span></code> keyword, if present, is followed by a number of <em>ordering directives</em>. Ordering directives have the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>orderbys ::= orderby (&quot;,&quot; orderby)*
orderby ::= simpleId (&quot;asc&quot; | &quot;desc&quot;)?
</pre></div>
</div>
<p>Each identifier in an ordering directive must identify exactly one of the select expressions. It must either be the label of the expression, or it must be a variable expression that is equivalent to exactly one of the select expressions. The type of the designated select expression must be a subtype of a primitive type.</p>
<p>No select expression may be specified by more than one ordering directive. See “<a class="reference external" href="#ordering">Ordering</a>” for more information.</p>
</section>
<section id="queries">
<h3>Queries<a class="headerlink" href="#queries" title="Link to this heading">¶</a></h3>
<p>The queries in a QL module are:</p>
<ul class="simple">
<li><p>The select clause, if any, defined in that module.</p></li>
<li><p>Any predicates annotated with <code class="docutils literal notranslate"><span class="pre">query</span></code> which are in scope in that module.</p></li>
</ul>
<p>The target predicate of the query is either the select clause or the annotated predicate.</p>
<p>Each argument of the target predicate of the query must be of a type which has a <code class="docutils literal notranslate"><span class="pre">toString()</span></code> member predicate.</p>
</section>
</section>
<section id="expressions">
<h2>Expressions<a class="headerlink" href="#expressions" title="Link to this heading">¶</a></h2>
<p>Expressions are a form of syntax used to denote values. Every expression has a typing environment that is determined by the context where the expression occurs. Every valid expression has a type, as specified in this section, except if it is a don’t-care expression.</p>
<p>Given a named tuple and a store, each expression has one or more <em>values</em>. This section specifies the values of each kind of expression.</p>
<p>There are several kinds of expressions:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>exprs ::= expr (&quot;,&quot; expr)*

expr ::= dontcare
     |   unop
     |   binop
     |   cast
     |   primary

primary ::= eparen
        |   literal
        |   variable
        |   super_expr
        |   callwithresult
        |   postfix_cast
        |   aggregation
        |   any
</pre></div>
</div>
<section id="parenthesized-expressions">
<h3>Parenthesized expressions<a class="headerlink" href="#parenthesized-expressions" title="Link to this heading">¶</a></h3>
<p>A parenthesized expression is an expression surrounded by parentheses:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>eparen ::= &quot;(&quot; expr &quot;)&quot;
</pre></div>
</div>
<p>The type environment of the nested expression is the same as that of the outer expression. The type and values of the outer expression are the same as those of the nested expression.</p>
</section>
<section id="don-t-care-expressions">
<h3>Don’t-care expressions<a class="headerlink" href="#don-t-care-expressions" title="Link to this heading">¶</a></h3>
<p>A don’t-care expression is written as a single underscore:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dontcare ::= &quot;_&quot;
</pre></div>
</div>
<p>All values are values of a don’t-care expression.</p>
</section>
<section id="literals">
<h3>Literals<a class="headerlink" href="#literals" title="Link to this heading">¶</a></h3>
<p>A literal expression is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>literal ::= &quot;false&quot; | &quot;true&quot; | int | float | string
</pre></div>
</div>
<p>The type of a literal expression is the type of the value denoted by the literal: <code class="docutils literal notranslate"><span class="pre">boolean</span></code> for <code class="docutils literal notranslate"><span class="pre">false</span></code> or <code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">int</span></code> for an integer literal, <code class="docutils literal notranslate"><span class="pre">float</span></code> for a floating-point literal, or <code class="docutils literal notranslate"><span class="pre">string</span></code> for a string literal. The value of a literal expression is the same as the value denoted by the literal.</p>
</section>
<section id="unary-operations">
<h3>Unary operations<a class="headerlink" href="#unary-operations" title="Link to this heading">¶</a></h3>
<p>A unary operation is the application of <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> to another expression:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>unop ::= &quot;+&quot; expr
     |   &quot;-&quot; expr
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">-</span></code> in the operation is called the <em>operator</em>, and the expression is called the <em>operand</em>. The typing environment of the operand is the same as for the unary operation.</p>
<p>For a valid unary operation, the operand must be of type <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">float</span></code>. The operation has the same type as its operand.</p>
<p>If the operator is <code class="docutils literal notranslate"><span class="pre">+</span></code>, then the values of the expression are the same as the values of the operand. If the operator is <code class="docutils literal notranslate"><span class="pre">-</span></code>, then the values of the expression are the arithmetic negations of the values of the operand.</p>
</section>
<section id="binary-operations">
<h3>Binary operations<a class="headerlink" href="#binary-operations" title="Link to this heading">¶</a></h3>
<p>A binary operation is written as a <em>left operand</em> followed by a <em>binary operator</em>, followed by a <em>right operand</em>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>binop ::= expr &quot;+&quot; expr
      |   expr &quot;-&quot; expr
      |   expr &quot;*&quot; expr
      |   expr &quot;/&quot; expr
      |   expr &quot;%&quot; expr
</pre></div>
</div>
<p>The typing environment for the two environments is the same as for the operation. If the operator is <code class="docutils literal notranslate"><span class="pre">+</span></code>, then either both operands must be subtypes of <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">float</span></code>, or at least one operand must be a subtype of <code class="docutils literal notranslate"><span class="pre">string</span></code>. If the operator is anything else, then each operand must be a subtype of <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<p>The type of the operation is <code class="docutils literal notranslate"><span class="pre">string</span></code> if either operand is a subtype of <code class="docutils literal notranslate"><span class="pre">string</span></code>. Otherwise, the type of the operation is <code class="docutils literal notranslate"><span class="pre">int</span></code> if both operands are subtypes of <code class="docutils literal notranslate"><span class="pre">int</span></code>. Otherwise, the type of the operation is <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<p>If the result is of type <code class="docutils literal notranslate"><span class="pre">string</span></code>, then the <em>left values</em> of the operation are the values of a “call with results” expression with the left operand as the receiver, <code class="docutils literal notranslate"><span class="pre">toString</span></code> as the predicate name, and no arguments (see “<a class="reference external" href="#calls-with-results">Calls with results</a>”). Otherwise the left values are the values of the left operand. Likewise, the <em>right values</em> are either the values from calling <code class="docutils literal notranslate"><span class="pre">toString</span></code> on the right operand, or the values of the right operand as it is.</p>
<p>The binary operation has one value for each combination of a left value and a right value. That value is determined as follows:</p>
<ul class="simple">
<li><p>If the left and right operand types are subtypes of string, then the operation has a value that is the concatenation of the left and right values.</p></li>
<li><p>Otherwise, if both operand types are subtypes of <code class="docutils literal notranslate"><span class="pre">int</span></code>, then the value of the operation is the result of applying the two’s-complement 32-bit integer operation corresponding to the QL binary operator.</p></li>
<li><p>Otherwise, both operand types must be subtypes of <code class="docutils literal notranslate"><span class="pre">float</span></code>. If either operand is of type <code class="docutils literal notranslate"><span class="pre">int</span></code> then they are converted to a float. The value of the operation is then the result of applying the IEEE 754 floating-point operator that corresponds to the QL binary operator: addition for <code class="docutils literal notranslate"><span class="pre">+</span></code>, subtraction for <code class="docutils literal notranslate"><span class="pre">-</span></code>, multiplication for <code class="docutils literal notranslate"><span class="pre">*</span></code>, division for <code class="docutils literal notranslate"><span class="pre">/</span></code>, or remainder for <code class="docutils literal notranslate"><span class="pre">%</span></code>.</p></li>
</ul>
</section>
<section id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Link to this heading">¶</a></h3>
<p>A variable has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>variable ::= varname | &quot;this&quot; | &quot;result&quot;
</pre></div>
</div>
<p>A valid variable expression must occur in the typing environment. The type of the variable expression is the same as the type of the variable in the typing environment.</p>
<p>The value of the variable is the value of the variable in the named tuple.</p>
</section>
<section id="super">
<h3>Super<a class="headerlink" href="#super" title="Link to this heading">¶</a></h3>
<p>A super expression has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>super_expr ::= &quot;super&quot; | type &quot;.&quot; &quot;super&quot;
</pre></div>
</div>
<p>For a super expression to be valid, the <code class="docutils literal notranslate"><span class="pre">this</span></code> keyword must have a type and value in the typing environment. The type of the expression is the same as the type of <code class="docutils literal notranslate"><span class="pre">this</span></code> in the typing environment.</p>
<p>A super expression may only occur in a QL program as the receiver expression for a predicate call.</p>
<p>If a super expression includes a <code class="docutils literal notranslate"><span class="pre">type</span></code>, then that type must be a class that the enclosing class inherits from.</p>
<p>The value of a super expression is the same as the value of <code class="docutils literal notranslate"><span class="pre">this</span></code> in the named tuple.</p>
</section>
<section id="casts">
<h3>Casts<a class="headerlink" href="#casts" title="Link to this heading">¶</a></h3>
<p>A cast expression is a type in parentheses followed by another expression:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>cast ::= &quot;(&quot; type &quot;)&quot; expr
</pre></div>
</div>
<p>The typing environment for the nested expression is the same as for the cast expression. The type of the cast expression is the type between parentheses.</p>
<p>The values of the cast expression are those values of the nested expression that are in the type given within parentheses.</p>
<p>For casts between the primitive <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span></code> types, the above rule means that for the cast expression to have a value, it must be representable as both 32-bit two’s complement integers and 64-bit IEEE 754 floats. Other values will not be included in the values of the cast expression.</p>
</section>
<section id="postfix-casts">
<h3>Postfix casts<a class="headerlink" href="#postfix-casts" title="Link to this heading">¶</a></h3>
<p>A postfix cast is a primary expression followed by a dot and then a class or primitive type in parentheses:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>postfix_cast ::= primary &quot;.&quot; &quot;(&quot; type &quot;)&quot;
</pre></div>
</div>
<p>All the rules for ordinary casts apply to postfix casts: a postfix cast is exactly equivalent to a parenthesized ordinary cast.</p>
</section>
<section id="calls-with-results">
<h3>Calls with results<a class="headerlink" href="#calls-with-results" title="Link to this heading">¶</a></h3>
<p>An expression for a call with results is of one of two forms:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>callwithresult ::= predicateRef (closure)? &quot;(&quot; (exprs)? &quot;)&quot;
               |   primary &quot;.&quot; predicateName (closure)? &quot;(&quot; (exprs)? &quot;)&quot;
closure        ::= &quot;*&quot; | &quot;+&quot;
</pre></div>
</div>
<p>The expressions in parentheses are the <em>arguments</em> of the call. The expression before the dot, if there is one, is the <em>receiver</em> of the call.</p>
<p>The type environment for the arguments is the same as for the call.</p>
<p>A valid call with results <em>resolves</em> to a set of predicates. The ways a call can resolve are as follows:</p>
<ul>
<li><p>If the call has no receiver and the predicate name is a simple identifier, then the predicate is resolved by looking up its name and arity in the visible member-predicate environment of the enclosing class.</p></li>
<li><p>If the call has no receiver and the predicate name is a simple identifier, then the predicate is resolved by looking up its name and arity in the visible predicate environment of the enclosing module.</p></li>
<li><p>If the call has no receiver and the predicate name is a selection identifier, then the qualifier is resolved as a module (see “<a class="reference external" href="#module-resolution">Module resolution</a>”). The identifier is then resolved in the exported predicate environment of the qualifier module.</p></li>
<li><dl class="simple">
<dt>If the call has a super expression as the receiver, then it resolves to a member predicate in a class that the enclosing class inherits from:</dt><dd><ul class="simple">
<li><p>If the super expression is unqualified and there is a single class that the current class inherits from, then the super-class is that class.</p></li>
<li><p>If the super expression is unqualified and there are multiple classes that the current class inherits from, then the super-class is the domain type.</p></li>
<li><p>Otherwise, the super-class is the class named by the qualifier of the super expression.</p></li>
</ul>
</dd>
</dl>
<p>The predicate is resolved by looking up its name and arity in the exported predicate environment of the super-class.</p>
</li>
<li><p>If the type of the receiver is the same as the enclosing class, the predicate is resolved by looking up its name and arity in the visible predicate environment of the class.</p></li>
<li><p>If the type of the receiver is not the same as the enclosing class, the predicate is resolved by looking up its name and arity in the exported predicate environment of the class or domain type.</p></li>
</ul>
<p>If all the predicates that the call resolves to are declared on a primitive type, we then restrict to the set of predicates where each argument of the call is a subtype of the corresponding predicate argument type.
Then we find all predicates <code class="docutils literal notranslate"><span class="pre">p</span></code> from this new set such that there is not another predicate <code class="docutils literal notranslate"><span class="pre">p'</span></code> where each argument of <code class="docutils literal notranslate"><span class="pre">p'</span></code> is a subtype of the corresponding argument in <code class="docutils literal notranslate"><span class="pre">p</span></code>. We then say the call resolves to this set instead.</p>
<p>A valid call must only resolve to a single predicate.</p>
<p>For each argument other than a don’t-care expression, the type of the argument must be compatible with the type of the corresponding argument type of the predicate, otherwise the call is invalid.</p>
<p>A valid call with results must resolve to a predicate that has a result type. That result type is also the type of the call.</p>
<p>If the resolved predicate is built in, then the call may not include a closure. If the call does have a closure, then it must resolve to a predicate where the <em>relational arity</em> of the predicate is 2. The relational arity of a predicate is the sum of the following numbers:</p>
<ul class="simple">
<li><p>The number of arguments to the predicate.</p></li>
<li><p>The number 1 if the predicate is a member predicate, otherwise 0.</p></li>
<li><p>The number 1 if the predicate has a result, otherwise 0.</p></li>
</ul>
<p>If the call includes a closure, then all declared predicate arguments, the enclosing type of the declaration (if it exists), and the result type of the declaration (if it exists) must be compatible. If one of those types is a subtype of <code class="docutils literal notranslate"><span class="pre">int</span></code>, then all the other arguments must be a subtype of <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p>If the call resolves to a member predicate, then the <em>receiver values</em> are as follows. If the call has a receiver, then the receiver values are the values of that receiver. If the call does not have a receiver, then the single receiver value is the value of <code class="docutils literal notranslate"><span class="pre">this</span></code> in the contextual named tuple.</p>
<p>The <em>tuple prefixes</em> of a call with results include one value from each of the argument expressions’ values, in the same order as the order of the arguments. If the call resolves to a non-member predicate, then those values are exactly the tuple prefixes of the call. If the call instead resolves to a member predicate, then the tuple prefixes additionally include a receiver value, ordered before the argument values.</p>
<p>The <em>matching tuples</em> of a call with results are all ordered tuples that are one of the tuple prefixes followed by any value of the same type as the call. If the call has no closure, then all matching tuples must additionally satisfy the resolved predicate of the call, unless the receiver is a super expression, in which case they must <em>directly</em> satisfy the resolved predicate of the call. If the call has a <code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">+</span></code> closure, then the matching tuples must satisfy or directly satisfy the associated closure of the resolved predicate.</p>
<p>The values of a call with results are the final elements of each of the call’s matching tuples.</p>
</section>
<section id="aggregations">
<h3>Aggregations<a class="headerlink" href="#aggregations" title="Link to this heading">¶</a></h3>
<p>An aggregation can be written in one of two forms:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>aggregation ::= aggid (&quot;[&quot; expr &quot;]&quot;)? &quot;(&quot; var_decls (&quot;|&quot; (formula)? (&quot;|&quot; as_exprs (&quot;order&quot; &quot;by&quot; aggorderbys)?)?)? &quot;)&quot;
            |   aggid (&quot;[&quot; expr &quot;]&quot;)? &quot;(&quot; as_exprs (&quot;order&quot; &quot;by&quot; aggorderbys)? &quot;)&quot;
            |   &quot;unique&quot; &quot;(&quot; var_decls &quot;|&quot; (formula)? (&quot;|&quot; as_exprs)? &quot;)&quot;

aggid ::= &quot;avg&quot; | &quot;concat&quot; | &quot;count&quot; | &quot;max&quot; | &quot;min&quot; | &quot;rank&quot; | &quot;strictconcat&quot; | &quot;strictcount&quot; | &quot;strictsum&quot; | &quot;sum&quot;

aggorderbys ::= aggorderby (&quot;,&quot; aggorderby)*

aggorderby ::= expr (&quot;asc&quot; | &quot;desc&quot;)?
</pre></div>
</div>
<p>The expression enclosed in square brackets (<code class="docutils literal notranslate"><span class="pre">[</span></code> and <code class="docutils literal notranslate"><span class="pre">]</span></code>, U+005B and U+005D), if present, is called the <em>rank expression</em>. It must have type <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">as_exprs</span></code>, if present, are called the <em>aggregation expressions</em>. If an aggregation expression is of the form <code class="docutils literal notranslate"><span class="pre">expr</span> <span class="pre">as</span> <span class="pre">v</span></code> then the expression is said to be <em>named</em> v.</p>
<p>The rank expression must be present if the aggregate id is <code class="docutils literal notranslate"><span class="pre">rank</span></code>; otherwise it must not be present.</p>
<p>Apart from the presence or absence of the rank variable, all other reduced forms of an aggregation are equivalent to a full form using the following steps:</p>
<ul class="simple">
<li><p>If the formula is omitted, then it is taken to be <code class="docutils literal notranslate"><span class="pre">any()</span></code>.</p></li>
<li><p>If there are no aggregation expressions, then either:</p>
<ul>
<li><p>The aggregation id is <code class="docutils literal notranslate"><span class="pre">count</span></code> or <code class="docutils literal notranslate"><span class="pre">strictcount</span></code> and the expression is taken to be <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p>There must be precisely one variable declaration, and the aggregation expression is taken to be a reference to that variable.</p></li>
</ul>
</li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">concat</span></code> or <code class="docutils literal notranslate"><span class="pre">strictconcat</span></code> and it has a single expression then the second expression is taken to be <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">monotonicAggregates</span></code> language pragma is not enabled, or the original formula and variable declarations are both omitted, then the aggregate is transformed as follows:</p>
<ul>
<li><p>For each aggregation expression <code class="docutils literal notranslate"><span class="pre">expr_i</span></code>, a fresh variable <code class="docutils literal notranslate"><span class="pre">v_i</span></code> is declared with the same type as the expression in addition to the original variable declarations.</p></li>
<li><p>The new range is the conjunction of the original range and a term <code class="docutils literal notranslate"><span class="pre">v_i</span> <span class="pre">=</span> <span class="pre">expr_i</span></code> for each aggregation expression <code class="docutils literal notranslate"><span class="pre">expr_i</span></code>.</p></li>
<li><p>Each original aggregation expression <code class="docutils literal notranslate"><span class="pre">expr_i</span></code> is replaced by a new aggregation expression <code class="docutils literal notranslate"><span class="pre">v_i</span></code>.</p></li>
</ul>
</li>
</ul>
<p>The variables in the variable declarations list must not occur in the typing environment.</p>
<p>The typing environment for the rank expression is the same as for the aggregation.</p>
<p>The typing environment for the formula is obtained by taking the typing environment for the aggregation and adding all the variable types in the given <code class="docutils literal notranslate"><span class="pre">var_decls</span></code> list.</p>
<p>The typing environment for an aggregation expression is obtained by taking the typing environment for the formula and then, for each named aggregation expression that occurs earlier than the current expression, adding a mapping from the earlier expression’s name to the earlier expression’s type.</p>
<p>The typing environment for ordering directives is obtained by taking the typing environment for the formula and then, for each named aggregation expression in the aggregation, adding a mapping from the expression’s name to the expression’s type.</p>
<p>The number and types of the aggregation expressions are restricted as follows:</p>
<ul class="simple">
<li><p>A <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">rank</span></code> or <code class="docutils literal notranslate"><span class="pre">unique</span></code> aggregation must have a single expression.</p></li>
<li><p>The type of the expression in a <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code> or <code class="docutils literal notranslate"><span class="pre">rank</span></code> aggregation without an ordering directive expression must be an orderable type.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">count</span></code> or <code class="docutils literal notranslate"><span class="pre">strictcount</span></code> aggregation must not have an expression.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">strictsum</span></code> or <code class="docutils literal notranslate"><span class="pre">avg</span></code> aggregation must have a single aggregation expression, which must have a type which is a subtype of <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">concat</span></code> or <code class="docutils literal notranslate"><span class="pre">strictconcat</span></code> aggregation must have two expressions. Both expressions must have types which are subtypes of <code class="docutils literal notranslate"><span class="pre">string</span></code>.</p></li>
</ul>
<p>The type of a <code class="docutils literal notranslate"><span class="pre">count</span></code>, <code class="docutils literal notranslate"><span class="pre">strictcount</span></code> aggregation is <code class="docutils literal notranslate"><span class="pre">int</span></code>. The type of an <code class="docutils literal notranslate"><span class="pre">avg</span></code> aggregation is <code class="docutils literal notranslate"><span class="pre">float</span></code>. The type of a <code class="docutils literal notranslate"><span class="pre">concat</span></code> or <code class="docutils literal notranslate"><span class="pre">strictconcat</span></code> aggregation is <code class="docutils literal notranslate"><span class="pre">string</span></code>. The type of a <code class="docutils literal notranslate"><span class="pre">sum</span></code> or <code class="docutils literal notranslate"><span class="pre">strictsum</span></code> aggregation is <code class="docutils literal notranslate"><span class="pre">int</span></code> if the aggregation expression is a subtype of <code class="docutils literal notranslate"><span class="pre">int</span></code>, otherwise it is <code class="docutils literal notranslate"><span class="pre">float</span></code>. The type of a <code class="docutils literal notranslate"><span class="pre">rank</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code> or <code class="docutils literal notranslate"><span class="pre">max</span></code> aggregation is the type of the single expression.</p>
<p>An ordering directive may only be specified for a <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code>, <code class="docutils literal notranslate"><span class="pre">rank</span></code>, <code class="docutils literal notranslate"><span class="pre">concat</span></code> or <code class="docutils literal notranslate"><span class="pre">strictconcat</span></code> aggregation. The type of the expression in an ordering directive must be an orderable type.</p>
<p>The values of the aggregation expression are determined as follows. Firstly, the <em>range tuples</em> are extensions of the named tuple that the aggregation is being evaluated in with the variable declarations of the aggregation, and which <em>match</em> the formula (see “<a class="reference external" href="#formulas">Formulas</a>”).</p>
<p>For each range tuple, the <em>aggregation tuples</em> are the extension of the range tuples to <em>aggregation variables</em> and <em>sort variables</em>.</p>
<p>The aggregation variables are given by the aggregation expressions. If an aggregation expression is named, then its aggregation variable is given by its name, otherwise a fresh synthetic variable is created. The value is given by evaluating the expression with the named tuple being the result of the previous expression, or the range tuple if this is the first aggregation expression.</p>
<p>The sort variables are synthetic variables created for each expression in the ordering directive with values given by the values of the expressions within the ordering directive.</p>
<p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">max</span></code>, <code class="docutils literal notranslate"><span class="pre">min</span></code> or <code class="docutils literal notranslate"><span class="pre">rank</span></code> and there was no ordering directive, then for each aggregation tuple a synthetic sort variable is added with value given by the aggregation variable.</p>
<p>The values of the aggregation expression are given by applying the aggregation function to each set of tuples obtained by picking exactly one aggregation tuple for each range tuple.</p>
<ul class="simple">
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">avg</span></code>, and the set is non-empty, then the resulting value is the average of the value for the aggregation variable in each tuple in the set, weighted by the number of tuples in the set, after converting the value to a floating-point number.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">count</span></code>, then the resulting value is the number of tuples in the set. If there are no tuples in the set, then the value is the integer <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">max</span></code>, then the values are the those values of the aggregation variable which are associated with a maximal tuple of sort values. If the set is empty, then the aggregation has no value.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">min</span></code>, then the values are the those values of the aggregation variable which are associated with a minimal tuple of sort values. If the set is empty, then the aggregation has no value.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">rank</span></code>, then the resulting values are values of the aggregation variable such that the number of aggregation tuples with a strictly smaller tuple of sort variables is exactly one less than an integer bound by the rank expression of the aggregation. If no such values exist, then the aggregation has no values.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">strictcount</span></code>, then the resulting value is the same as if the aggregation id were <code class="docutils literal notranslate"><span class="pre">count</span></code>, unless the set of tuples is empty. If the set of tuples is empty, then the aggregation has no value.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">strictsum</span></code>, then the resulting value is the same as if the aggregation id were <code class="docutils literal notranslate"><span class="pre">sum</span></code>, unless the set of tuples is empty. If the set of tuples is empty, then the aggregation has no value.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">sum</span></code>, then the resulting value is the same as the sum of the values of the aggregation variable across the tuples in the set, weighted by the number of times each value occurs in the tuples in the set. If there are no tuples in the set, then the resulting value of the aggregation is the integer <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">concat</span></code>, then there is one value for each value of the second aggregation variable, given by the concatenation of the value of the first aggregation variable of each tuple with the value of the second aggregation variable used as a separator, ordered by the sort variables. If there are multiple aggregation tuples with the same sort variables then the first distinguished value is used to break ties. If there are no tuples in the set, then the single value of the aggregation is the empty string.</p></li>
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">strictconcat</span></code>, then the result is the same as for <code class="docutils literal notranslate"><span class="pre">concat</span></code> except in the case where there are no aggregation tuples in which case the aggregation has no value.</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>If the aggregation id is <code class="docutils literal notranslate"><span class="pre">unique</span></code>, then the result is the value of the aggregation variable if there is precisely one such value. Otherwise, the aggregation has no value.</p></li>
</ul>
</div></blockquote>
</section>
<section id="any">
<h3>Any<a class="headerlink" href="#any" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">any</span></code> expression is a special kind of quantified expression.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>any ::= &quot;any&quot; &quot;(&quot; var_decls (&quot;|&quot; (formula)? (&quot;|&quot; expr)?)? &quot;)&quot;
</pre></div>
</div>
<p>The values of an <code class="docutils literal notranslate"><span class="pre">any</span></code> expression are those values of the expression for which the formula matches.</p>
<p>The abbreviated cases for an <code class="docutils literal notranslate"><span class="pre">any</span></code> expression are interpreted in the same way as for an aggregation.</p>
</section>
<section id="ranges">
<h3>Ranges<a class="headerlink" href="#ranges" title="Link to this heading">¶</a></h3>
<p>Range expressions denote a range of values.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>range ::= &quot;[&quot; expr &quot;..&quot; expr &quot;]&quot;
</pre></div>
</div>
<p>Both expressions must be subtypes of <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">float</span></code>, or <code class="docutils literal notranslate"><span class="pre">date</span></code>. If either of them are type <code class="docutils literal notranslate"><span class="pre">date</span></code>, then both of them must be.</p>
<p>If both expressions are subtypes of <code class="docutils literal notranslate"><span class="pre">int</span></code> then the type of the range is <code class="docutils literal notranslate"><span class="pre">int</span></code>. If both expressions are subtypes of <code class="docutils literal notranslate"><span class="pre">date</span></code> then the type of the range is <code class="docutils literal notranslate"><span class="pre">date</span></code>. Otherwise the type of the range is <code class="docutils literal notranslate"><span class="pre">float</span></code>.</p>
<p>The values of a range expression are those values which are ordered inclusively between a value of the first expression and a value of the second expression.</p>
</section>
<section id="set-literals">
<h3>Set literals<a class="headerlink" href="#set-literals" title="Link to this heading">¶</a></h3>
<p>Set literals denote a choice from a collection of values.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>setliteral ::= &quot;[&quot; expr (&quot;,&quot; expr)* &quot;,&quot;? &quot;]&quot;
</pre></div>
</div>
<p>Set literals can be of any type, but the types within a set literal have to be consistent according to the following criterion: At least one of the set elements has to be of a type that is a supertype of all the set element types. This supertype is the type of the set literal. For example, <code class="docutils literal notranslate"><span class="pre">float</span></code> is a supertype of <code class="docutils literal notranslate"><span class="pre">float</span></code> and <code class="docutils literal notranslate"><span class="pre">int</span></code>, therefore <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">=</span> <span class="pre">[4,</span> <span class="pre">5.6]</span></code> is valid. On the other hand, <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">=</span> <span class="pre">[5,</span> <span class="pre">&quot;test&quot;]</span></code> does not adhere to the criterion.</p>
<p>The values of a set literal expression are all the values of all the contained element expressions.</p>
<p>Set literals are supported from release 2.1.0 of the CodeQL CLI, and release 1.24 of LGTM Enterprise.</p>
<p>Since release 2.7.1 of the CodeQL CLI, and release 1.30 of LGTM Enterprise, a trailing comma is allowed in a set literal.</p>
</section>
</section>
<section id="disambiguation-of-expressions">
<h2>Disambiguation of expressions<a class="headerlink" href="#disambiguation-of-expressions" title="Link to this heading">¶</a></h2>
<p>The grammar given in this section is disambiguated first by precedence, and second by associating left to right. The order of precedence from highest to lowest is:</p>
<ul class="simple">
<li><p>casts</p></li>
<li><p>unary <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code></p></li>
<li><p>binary <code class="docutils literal notranslate"><span class="pre">*</span></code> , <code class="docutils literal notranslate"><span class="pre">/</span></code> and <code class="docutils literal notranslate"><span class="pre">%</span></code></p></li>
<li><p>binary <code class="docutils literal notranslate"><span class="pre">+</span></code> and <code class="docutils literal notranslate"><span class="pre">-</span></code></p></li>
</ul>
<p>Whenever a sequence of tokens can be interpreted either as a call to a predicate with result (with specified closure), or as a binary operation with operator <code class="docutils literal notranslate"><span class="pre">+</span></code> or <code class="docutils literal notranslate"><span class="pre">*</span></code>, the syntax is interpreted as a call to a predicate with result.</p>
<p>Whenever a sequence of tokens can be interpreted either as arithmetic with a parenthesized variable or as a prefix cast of a unary operation, the syntax is interpreted as a cast.</p>
</section>
<section id="formulas">
<h2>Formulas<a class="headerlink" href="#formulas" title="Link to this heading">¶</a></h2>
<p>A formula is a form of syntax used to <em>match</em> a named tuple given a store.</p>
<p>There are several kinds of formulas:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>formula ::= fparen
        |   disjunction
        |   conjunction
        |   implies
        |   ifthen
        |   negated
        |   quantified
        |   comparison
        |   instanceof
        |   inrange
        |   call
</pre></div>
</div>
<p>This section specifies the syntax for each kind of formula and what tuples they match.</p>
<section id="parenthesized-formulas">
<h3>Parenthesized formulas<a class="headerlink" href="#parenthesized-formulas" title="Link to this heading">¶</a></h3>
<p>A parenthesized formula is a formula enclosed by a pair of parentheses:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>fparen ::= &quot;(&quot; formula &quot;)&quot;
</pre></div>
</div>
<p>A parenthesized formula matches the same tuples as the nested formula matches.</p>
</section>
<section id="disjunctions">
<h3>Disjunctions<a class="headerlink" href="#disjunctions" title="Link to this heading">¶</a></h3>
<p>A disjunction is two formulas separated by the <code class="docutils literal notranslate"><span class="pre">or</span></code> keyword:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>disjunction ::= formula &quot;or&quot; formula
</pre></div>
</div>
<p>A disjunction matches any tuple that matches either of the nested formulas.</p>
</section>
<section id="conjunctions">
<h3>Conjunctions<a class="headerlink" href="#conjunctions" title="Link to this heading">¶</a></h3>
<p>A conjunction is two formulas separated by the <code class="docutils literal notranslate"><span class="pre">and</span></code> keyword:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>conjunction ::= formula &quot;and&quot; formula
</pre></div>
</div>
<p>A conjunction matches any tuple that also matches both of the two nested formulas.</p>
</section>
<section id="implications">
<h3>Implications<a class="headerlink" href="#implications" title="Link to this heading">¶</a></h3>
<p>An implication formula is two formulas separated by the <code class="docutils literal notranslate"><span class="pre">implies</span></code> keyword:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>implies ::= formula &quot;implies&quot; formula
</pre></div>
</div>
<p>Neither of the two formulas may be another implication.</p>
<p>An implied formula matches if either the second formula matches, or the first formula does not match.</p>
</section>
<section id="conditional-formulas">
<h3>Conditional formulas<a class="headerlink" href="#conditional-formulas" title="Link to this heading">¶</a></h3>
<p>A conditional formula has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ifthen ::= &quot;if&quot; formula &quot;then&quot; formula &quot;else&quot; formula
</pre></div>
</div>
<p>The first formula is called the <em>condition</em> of the conditional formula. The second formula is called the <em>true branch</em>, and the second formula is called the <em>false branch</em>.</p>
<p>The conditional formula matches if the condition and the true branch both match. It also matches if the false branch matches and the condition does not match.</p>
</section>
<section id="negations">
<h3>Negations<a class="headerlink" href="#negations" title="Link to this heading">¶</a></h3>
<p>A negation formula is a formula preceded by the <code class="docutils literal notranslate"><span class="pre">not</span></code> keyword:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>negated ::= &quot;not&quot; formula
</pre></div>
</div>
<p>A negation formula matches any tuple that does not match the nested formula.</p>
</section>
<section id="quantified-formulas">
<h3>Quantified formulas<a class="headerlink" href="#quantified-formulas" title="Link to this heading">¶</a></h3>
<p>A quantified formula has several syntaxes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>quantified ::= &quot;exists&quot; &quot;(&quot; expr &quot;)&quot;
           |   &quot;exists&quot; &quot;(&quot; var_decls (&quot;|&quot; formula)? (&quot;|&quot; formula)? &quot;)&quot;
           |   &quot;forall&quot; &quot;(&quot; var_decls (&quot;|&quot; formula)? &quot;|&quot; formula &quot;)&quot;
           |   &quot;forex&quot;  &quot;(&quot; var_decls (&quot;|&quot; formula)? &quot;|&quot; formula &quot;)&quot;
</pre></div>
</div>
<p>In all cases, the typing environment for the nested expressions or formulas is the same as the typing environment for the quantified formula, except that it also maps the variables in the variable declaration to their associated types.</p>
<p>The first form matches if the given expression has at least one value.</p>
<p>For the other forms, the extensions of the current named tuple for the given variable declarations are called the <em>quantifier extensions</em>. The nested formulas are called the <em>first quantified formula</em> and, if present, the <em>second quantified formula</em>.</p>
<p>The second <code class="docutils literal notranslate"><span class="pre">exists</span></code> formula matches if one of the quantifier extensions is such that the quantified formula or formulas all match.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">forall</span></code> formula that has one quantified formula matches if that quantified formula matches all of the quantifier extensions. A <code class="docutils literal notranslate"><span class="pre">forall</span></code> with two quantified formulas matches if the second formula matches all extensions where the first formula matches.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">forex</span></code> formula with one quantified formula matches under the same conditions as a <code class="docutils literal notranslate"><span class="pre">forall</span></code> formula matching, except that there must be at least one quantifier extension where that first quantified formula matches.</p>
</section>
<section id="comparisons">
<h3>Comparisons<a class="headerlink" href="#comparisons" title="Link to this heading">¶</a></h3>
<p>A comparison formula is two expressions separated by a comparison operator:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>comparison ::= expr compop expr
compop ::= &quot;=&quot; | &quot;!=&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;&lt;=&quot; | &quot;&gt;=&quot;
</pre></div>
</div>
<p>A comparison formula matches if there is one value of the left expression that is in the given ordering with one of the values of the right expression. The ordering used is specified in “<a class="reference external" href="#ordering">Ordering</a>.” If one of the values is an integer and the other is a float value, then the integer is converted to a float value before the comparison.</p>
<p>If the operator is <code class="docutils literal notranslate"><span class="pre">=</span></code>, then at least one of the left and right expressions must have a type; if they both have a type, those types must be compatible.</p>
<p>If the operator is <code class="docutils literal notranslate"><span class="pre">!=</span></code>, then both expressions must have a type, and those types must be compatible.</p>
<p>If the operator is any other operator, then both expressions must have a type. Those types must be compatible with each other. Each of those types must be orderable.</p>
</section>
<section id="type-checks">
<h3>Type checks<a class="headerlink" href="#type-checks" title="Link to this heading">¶</a></h3>
<p>A type check formula has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>instanceof ::= expr &quot;instanceof&quot; type
</pre></div>
</div>
<p>The type to the right of <code class="docutils literal notranslate"><span class="pre">instanceof</span></code> is called the <em>type-check type</em>.</p>
<p>The type of the expression must be compatible with the type-check type.</p>
<p>The formula matches if one of the values of the expression is in the type-check type.</p>
</section>
<section id="range-checks">
<h3>Range checks<a class="headerlink" href="#range-checks" title="Link to this heading">¶</a></h3>
<p>A range check has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>inrange ::= expr &quot;in&quot; range
</pre></div>
</div>
<p>The formula is equivalent to <code class="docutils literal notranslate"><span class="pre">expr</span> <span class="pre">&quot;=&quot;</span> <span class="pre">range</span></code>.</p>
</section>
<section id="calls">
<h3>Calls<a class="headerlink" href="#calls" title="Link to this heading">¶</a></h3>
<p>A call has the following syntax:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>call ::= predicateRef (closure)? &quot;(&quot; (exprs)? &quot;)&quot;
     |   primary &quot;.&quot; predicateName (closure)? &quot;(&quot; (exprs)? &quot;)&quot;
</pre></div>
</div>
<p>The identifier is called the <em>predicate name</em> of the call.</p>
<p>A call must resolve to a predicate, using the same definition of resolve as for calls with results (see “<a class="reference external" href="#calls-with-results">Calls with results</a>”).</p>
<p>The resolved predicate must not have a result type.</p>
<p>If the resolved predicate is a built-in member predicate of a primitive type, then the call may not include a closure. If the call does have a closure, then the call must resolve to a predicate with relational arity of 2.</p>
<p>The <em>candidate tuples</em> of a call are the ordered tuples formed by selecting a value from each of the arguments of the call.</p>
<p>If the call has no closure, then it matches whenever one of the candidate tuples satisfies the resolved predicate of the call, unless the call has a super expression as a receiver, in which case the candidate tuple must <em>directly</em> satisfy the resolved predicate. If the call has <code class="docutils literal notranslate"><span class="pre">*</span></code> or <code class="docutils literal notranslate"><span class="pre">+</span></code> closure, then the call matches whenever one of the candidate tuples satisfies or directly satisfies the associated closure of the resolved predicate.</p>
</section>
<section id="disambiguation-of-formulas">
<h3>Disambiguation of formulas<a class="headerlink" href="#disambiguation-of-formulas" title="Link to this heading">¶</a></h3>
<p>The grammar given in this section is disambiguated first by precedence, and second by associating left to right, except for implication which is non-associative. The order of precedence from highest to lowest is:</p>
<ul class="simple">
<li><p>Negation</p></li>
<li><p>Conditional formulas</p></li>
<li><p>Conjunction</p></li>
<li><p>Disjunction</p></li>
<li><p>Implication</p></li>
</ul>
</section>
</section>
<section id="aliases">
<h2>Aliases<a class="headerlink" href="#aliases" title="Link to this heading">¶</a></h2>
<p>Aliases define new names for existing QL entities.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>alias ::= qldoc? annotations &quot;predicate&quot; literalId &quot;=&quot; predicateRef &quot;/&quot; int &quot;;&quot;
      |   qldoc? annotations &quot;class&quot; classname &quot;=&quot; type &quot;;&quot;
      |   qldoc? annotations &quot;module&quot; modulename &quot;=&quot; moduleId &quot;;&quot;
</pre></div>
</div>
<p>An alias introduces a binding from the new name to the entity referred to by the right-hand side in the current module’s declared predicate, type, or module environment respectively.</p>
</section>
<section id="built-ins">
<h2>Built-ins<a class="headerlink" href="#built-ins" title="Link to this heading">¶</a></h2>
<p>A QL database includes a number of <em>built-in predicates</em> . This section defines a number of built-in predicates that all databases include. Each database also includes a number of additional non-member predicates that are not specified in this document.</p>
<p>This section gives several tables of built-in predicates. For each predicate, the table gives the result type of each predicate that has one, and the sequence of argument types.</p>
<p>Each table also specifies which ordered tuples are in the database content of each predicate. It specifies this with a description that holds true for exactly the tuples that are included. In each description, the “result” is the last element of each tuple, if the predicate has a result type. The “receiver” is the first element of each tuple. The “arguments” are all elements of each tuple other than the result and the receiver.</p>
<section id="non-member-built-ins">
<h3>Non-member built-ins<a class="headerlink" href="#non-member-built-ins" title="Link to this heading">¶</a></h3>
<p>The following built-in predicates are non-member predicates:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Result type</p></th>
<th class="head"><p>Argument types</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">any</span></code></p></td>
<td></td>
<td></td>
<td><p>The empty tuple.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">none</span></code></p></td>
<td></td>
<td></td>
<td><p>No tuples.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toUrl</span></code></p></td>
<td></td>
<td><p>string, int, int, int, int, string</p></td>
<td><p>Let the arguments be <code class="docutils literal notranslate"><span class="pre">file</span></code>, <code class="docutils literal notranslate"><span class="pre">startLine</span></code>, <code class="docutils literal notranslate"><span class="pre">startCol</span></code>, <code class="docutils literal notranslate"><span class="pre">endLine</span></code>, <code class="docutils literal notranslate"><span class="pre">endCol</span></code>, and <code class="docutils literal notranslate"><span class="pre">url</span></code>. The predicate holds if <code class="docutils literal notranslate"><span class="pre">url</span></code> is equal to the string <code class="docutils literal notranslate"><span class="pre">file://file:startLine:startCol:endLine:endCol</span></code>.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="built-ins-for-boolean">
<h3>Built-ins for boolean<a class="headerlink" href="#built-ins-for-boolean" title="Link to this heading">¶</a></h3>
<p>The following built-in predicates are members of type <code class="docutils literal notranslate"><span class="pre">boolean</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Result type</p></th>
<th class="head"><p>Argument types</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">booleanAnd</span></code></p></td>
<td><p>boolean</p></td>
<td><p>boolean</p></td>
<td><p>The result is the boolean and of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">booleanNot</span></code></p></td>
<td><p>boolean</p></td>
<td></td>
<td><p>The result is the boolean not of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">booleanOr</span></code></p></td>
<td><p>boolean</p></td>
<td><p>boolean</p></td>
<td><p>The result is the boolean or of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">booleanXor</span></code></p></td>
<td><p>boolean</p></td>
<td><p>boolean</p></td>
<td><p>The result is the boolean exclusive or of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toString</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is “true” if the receiver is <code class="docutils literal notranslate"><span class="pre">true</span></code>, otherwise “false.”</p></td>
</tr>
</tbody>
</table>
</section>
<section id="built-ins-for-date">
<h3>Built-ins for date<a class="headerlink" href="#built-ins-for-date" title="Link to this heading">¶</a></h3>
<p>The following built-in predicates are members of type <code class="docutils literal notranslate"><span class="pre">date</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Result type</p></th>
<th class="head"><p>Argument types</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">daysTo</span></code></p></td>
<td><p>int</p></td>
<td><p>date</p></td>
<td><p>The result is the number of days between but not including the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">getDay</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the day component of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">getHours</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the hours component of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">getMinutes</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the minutes component of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">getMonth</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is a string that is determined by the month component of the receiver.
The string is one of <code class="docutils literal notranslate"><span class="pre">January</span></code>, <code class="docutils literal notranslate"><span class="pre">February</span></code>, <code class="docutils literal notranslate"><span class="pre">March</span></code>, <code class="docutils literal notranslate"><span class="pre">April</span></code>, <code class="docutils literal notranslate"><span class="pre">May</span></code>, <code class="docutils literal notranslate"><span class="pre">June</span></code>,
<code class="docutils literal notranslate"><span class="pre">July</span></code>, <code class="docutils literal notranslate"><span class="pre">August</span></code>, <code class="docutils literal notranslate"><span class="pre">September</span></code>, <code class="docutils literal notranslate"><span class="pre">October</span></code>, <code class="docutils literal notranslate"><span class="pre">November</span></code>, or <code class="docutils literal notranslate"><span class="pre">December</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">getSeconds</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the seconds component of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">getYear</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the year component of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toISO</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is a string representation of the date. The representation is left unspecified.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toString</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is a string representation of the date. The representation is left unspecified.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="built-ins-for-float">
<h3>Built-ins for float<a class="headerlink" href="#built-ins-for-float" title="Link to this heading">¶</a></h3>
<p>The following built-in predicates are members of type <code class="docutils literal notranslate"><span class="pre">float</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Result type</p></th>
<th class="head"><p>Argument types</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abs</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the absolute value of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">acos</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the inverse cosine of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">asin</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the inverse sine of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">atan</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the inverse tangent of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">ceil</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the smallest integer greater than or equal to the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">copySign</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the floating point number with the magnitude of the receiver and the sign of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cos</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the cosine of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cosh</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the hyperbolic cosine of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exp</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the value of e, the base of the natural logarithm, raised to the power of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">floor</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the largest integer that is not greater than the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the natural logarithm of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the logarithm of the receiver with the base of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log</span></code></p></td>
<td><p>float</p></td>
<td><p>int</p></td>
<td><p>The result is the logarithm of the receiver with the base of the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log10</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the base-10 logarithm of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log2</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the base-2 logarithm of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">maximum</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the larger of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">maximum</span></code></p></td>
<td><p>float</p></td>
<td><p>int</p></td>
<td><p>The result is the larger of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">minimum</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the smaller of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">minimum</span></code></p></td>
<td><p>float</p></td>
<td><p>int</p></td>
<td><p>The result is the smaller of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nextAfter</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the number adjacent to the receiver in the direction of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">nextDown</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the number adjacent to the receiver in the direction of negative infinity.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">nextUp</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the number adjacent to the receiver in the direction of positive infinity.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pow</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the receiver raised to the power of the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pow</span></code></p></td>
<td><p>float</p></td>
<td><p>int</p></td>
<td><p>The result is the receiver raised to the power of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">signum</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the sign of the receiver: zero if it is zero, 1.0 if it is greater than zero, -1.0 if it is less than zero.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sin</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the sine of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sinh</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the hyperbolic sine of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sqrt</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the square root of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tan</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the tangent of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tanh</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the hyperbolic tangent of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toString</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The decimal representation of the number as a string.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">ulp</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the ULP (unit in last place) of the receiver.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="built-ins-for-int">
<h3>Built-ins for int<a class="headerlink" href="#built-ins-for-int" title="Link to this heading">¶</a></h3>
<p>The following built-in predicates are members of type <code class="docutils literal notranslate"><span class="pre">int</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Result type</p></th>
<th class="head"><p>Argument types</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">abs</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the absolute value of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">acos</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the inverse cosine of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">asin</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the inverse sine of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">atan</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the inverse tangent of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">cos</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the cosine of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">cosh</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the hyperbolic cosine of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">exp</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the value of value of e, the base of the natural logarithm, raised to the power of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">gcd</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the greatest common divisor of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the natural logarithm of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the logarithm of the receiver with the base of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log</span></code></p></td>
<td><p>float</p></td>
<td><p>int</p></td>
<td><p>The result is the logarithm of the receiver with the base of the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">log10</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the base-10 logarithm of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">log2</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the base-2 logarithm of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">maximum</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the larger of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">maximum</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the larger of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">minimum</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the smaller of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">minimum</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the smaller of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pow</span></code></p></td>
<td><p>float</p></td>
<td><p>float</p></td>
<td><p>The result is the receiver raised to the power of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pow</span></code></p></td>
<td><p>float</p></td>
<td><p>int</p></td>
<td><p>The result is the receiver raised to the power of the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sin</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the sine of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">sinh</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the hyperbolic sine of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">sqrt</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the square root of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">tan</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the tangent of the receiver.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">tanh</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the hyperbolic tangent of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bitAnd</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the bitwise and of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bitOr</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the bitwise or of the receiver and the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bitXor</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the bitwise xor of the receiver and the argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bitNot</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the bitwise complement of the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bitShiftLeft</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the bitwise left shift of the receiver by the argument, modulo 32.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">bitShiftRight</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the bitwise right shift of the receiver by the argument, modulo 32.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">bitShiftRightSigned</span></code></p></td>
<td><p>int</p></td>
<td><p>int</p></td>
<td><p>The result is the signed bitwise right shift of the receiver by the argument, modulo 32.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toString</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is the decimal representation of the number as a string.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toUnicode</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is the unicode character for the receiver seen as a unicode code point.</p></td>
</tr>
</tbody>
</table>
<p>The leftmost bit after <code class="docutils literal notranslate"><span class="pre">bitShiftRightSigned</span></code> depends on sign extension, whereas after <code class="docutils literal notranslate"><span class="pre">bitShiftRight</span></code> it is zero.</p>
</section>
<section id="built-ins-for-string">
<h3>Built-ins for string<a class="headerlink" href="#built-ins-for-string" title="Link to this heading">¶</a></h3>
<p>The following built-in predicates are members of type <code class="docutils literal notranslate"><span class="pre">string</span></code>:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Result type</p></th>
<th class="head"><p>Argument types</p></th>
<th class="head"><p>Content</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">charAt</span></code></p></td>
<td><p>string</p></td>
<td><p>int</p></td>
<td><p>The result is a 1-character string containing the character in the receiver at the index given by the argument. The first element of the string is at index 0.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">indexOf</span></code></p></td>
<td><p>int</p></td>
<td><p>string</p></td>
<td><p>The result is an index into the receiver where the argument occurs.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">indexOf</span></code></p></td>
<td><p>int</p></td>
<td><p>string, int, int</p></td>
<td><p>Let the arguments be <code class="docutils literal notranslate"><span class="pre">s</span></code>, <code class="docutils literal notranslate"><span class="pre">n</span></code>, and <code class="docutils literal notranslate"><span class="pre">start</span></code>. The result is the index of occurrence <code class="docutils literal notranslate"><span class="pre">n</span></code> of <code class="docutils literal notranslate"><span class="pre">substring</span></code> <code class="docutils literal notranslate"><span class="pre">s</span></code> in the receiver that is no earlier in the string than <code class="docutils literal notranslate"><span class="pre">start</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">isLowercase</span></code></p></td>
<td></td>
<td></td>
<td><p>The receiver contains no upper-case letters.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">isUppercase</span></code></p></td>
<td></td>
<td></td>
<td><p>The receiver contains no lower-case letters.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">length</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the number of characters in the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">matches</span></code></p></td>
<td></td>
<td><p>string</p></td>
<td><p>The argument is a pattern that matches the receiver, in the same way as the LIKE operator in SQL. Patterns may include <code class="docutils literal notranslate"><span class="pre">_</span></code> to match a single character and <code class="docutils literal notranslate"><span class="pre">%</span></code> to match any sequence of characters. A backslash can be used to escape an underscore, a percent, or a backslash. Otherwise, all characters in the pattern other than <code class="docutils literal notranslate"><span class="pre">_</span></code> and <code class="docutils literal notranslate"><span class="pre">%</span></code> and <code class="docutils literal notranslate"><span class="pre">\\</span></code> must match exactly.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">prefix</span></code></p></td>
<td><p>string</p></td>
<td><p>int</p></td>
<td><p>The result is the prefix of the receiver that has a length exactly equal to the argument. If the argument is negative or greater than the receiver’s length, then there is no result.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">regexpCapture</span></code></p></td>
<td><p>string</p></td>
<td><p>string, int</p></td>
<td><p>The receiver exactly matches the regex in the first argument, and the result is the group of the match numbered by the second argument.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">regexpFind</span></code></p></td>
<td><p>string</p></td>
<td><p>string, int, int</p></td>
<td><p>The receiver contains one or more occurrences of the regex in the first argument. The result is the <code class="docutils literal notranslate"><span class="pre">substring</span></code> which matches the regex, the second argument is the occurrence number, and the third argument is the index within the receiver at which the occurrence begins.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">regexpMatch</span></code></p></td>
<td></td>
<td><p>string</p></td>
<td><p>The receiver matches the argument as a regex.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">regexpReplaceAll</span></code></p></td>
<td><p>string</p></td>
<td><p>string, string</p></td>
<td><p>The result is obtained by replacing all occurrences in the receiver of the first argument as a regex by the second argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">replaceAll</span></code></p></td>
<td><p>string</p></td>
<td><p>string, string</p></td>
<td><p>The result is obtained by replacing all occurrences in the receiver of the first argument by the second.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">splitAt</span></code></p></td>
<td><p>string</p></td>
<td><p>string</p></td>
<td><p>The result is one of the strings obtained by splitting the receiver at every occurrence of the argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">splitAt</span></code></p></td>
<td><p>string</p></td>
<td><p>string, int</p></td>
<td><p>Let the arguments be <code class="docutils literal notranslate"><span class="pre">delim</span></code> and <code class="docutils literal notranslate"><span class="pre">i</span></code>. The result is field number <code class="docutils literal notranslate"><span class="pre">i</span></code> of the fields obtained by splitting the receiver at every occurrence of <code class="docutils literal notranslate"><span class="pre">delim</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">substring</span></code></p></td>
<td><p>string</p></td>
<td><p>int, int</p></td>
<td><p>The result is the <code class="docutils literal notranslate"><span class="pre">substring</span></code> of the receiver starting at the index of the first argument and ending just before the index of the second argument.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">suffix</span></code></p></td>
<td><p>string</p></td>
<td><p>int</p></td>
<td><p>The result is the suffix of the receiver that has a length exactly equal to the receiver’s length minus the argument. If the argument is negative or greater than the receiver’s length, then there is no result. As a result, the identity <code class="docutils literal notranslate"><span class="pre">s.prefix(i)+s.suffix(i)=s</span></code> holds for <code class="docutils literal notranslate"><span class="pre">i</span></code> in <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">s.length()]</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toDate</span></code></p></td>
<td><p>date</p></td>
<td></td>
<td><p>The result is a date value determined by the receiver. The format of the receiver is unspecified, except that if <code class="docutils literal notranslate"><span class="pre">(d,</span> <span class="pre">s)</span></code> is in <code class="docutils literal notranslate"><span class="pre">date.toString</span></code>, <code class="docutils literal notranslate"><span class="pre">(s,</span> <span class="pre">d)</span></code> is in <code class="docutils literal notranslate"><span class="pre">string.toDate</span></code>.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toFloat</span></code></p></td>
<td><p>float</p></td>
<td></td>
<td><p>The result is the float whose value is represented by the receiver. If the receiver cannot be parsed as a float then there is no result.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toInt</span></code></p></td>
<td><p>int</p></td>
<td></td>
<td><p>The result is the integer whose value is represented by the receiver. If the receiver cannot be parsed as an integer or cannot be represented as a QL <code class="docutils literal notranslate"><span class="pre">int</span></code>, then there is no result. The parser accepts an optional leading <code class="docutils literal notranslate"><span class="pre">-</span></code> or <code class="docutils literal notranslate"><span class="pre">+</span></code> character, followed by one or more decimal digits.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toLowerCase</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is the receiver with all letters converted to lower case.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">toString</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is the receiver.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">toUpperCase</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is the receiver with all letters converted to upper case.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">trim</span></code></p></td>
<td><p>string</p></td>
<td></td>
<td><p>The result is the receiver with all whitespace removed from the beginning and end of the string.</p></td>
</tr>
</tbody>
</table>
<p>Regular expressions are as defined by <code class="docutils literal notranslate"><span class="pre">java.util.regex.Pattern</span></code> in Java.
For more information, see the <a class="reference external" href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/regex/Pattern.html">Java API Documentation</a>.</p>
</section>
</section>
<section id="evaluation">
<h2>Evaluation<a class="headerlink" href="#evaluation" title="Link to this heading">¶</a></h2>
<p>This section specifies the evaluation of a QL program. Evaluation happens in three phases. First, the program is stratified into a number of layers. Second, the layers are evaluated one by one. Finally, the queries in the QL file are evaluated to produce sets of ordered tuples.</p>
<section id="stratification">
<h3>Stratification<a class="headerlink" href="#stratification" title="Link to this heading">¶</a></h3>
<p>A QL program can be <em>stratified</em> to a sequence of <em>layers</em>. A layer is a set of predicates and types.</p>
<p>A valid stratification must include each predicate and type in the QL program. It must not include any other predicates or types.</p>
<p>A valid stratification must not include the same predicate in multiple layers.</p>
<p>Formulas, variable declarations and expressions within a predicate body have a <em>negation polarity</em> that is positive, negative, or zero. Positive and negative are opposites of each other, while zero is the opposite of itself. The negation polarity of a formula or expression is then determined as follows:</p>
<ul class="simple">
<li><p>The body of a predicate is positive.</p></li>
<li><p>The formula within a negation formula has the opposite polarity to that of the negation formula.</p></li>
<li><p>The condition of a conditional formula has zero polarity.</p></li>
<li><p>The formula on the left of an implication formula has the opposite polarity to that of the implication.</p></li>
<li><p>The formula and variable declarations of an aggregate have zero polarity.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">monotonicAggregates</span></code> language pragma is not enabled, or the original formula and variable declarations are both omitted, then the expressions and order by expressions of the aggregate have zero polarity.</p></li>
<li><p>If the <code class="docutils literal notranslate"><span class="pre">monotonicAggregates</span></code> language pragma is enabled, and the original formula and variable declarations were not both omitted, then the expressions and order by expressions of the aggregate have the polarity of the aggregate.</p></li>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">forall</span></code> has two quantified formulas, then the first quantified formula has the opposite polarity to that of the <code class="docutils literal notranslate"><span class="pre">forall</span></code>.</p></li>
<li><p>The variable declarations of a <code class="docutils literal notranslate"><span class="pre">forall</span></code> have the opposite polarity to that of the <code class="docutils literal notranslate"><span class="pre">forall</span></code>.</p></li>
<li><p>If a <code class="docutils literal notranslate"><span class="pre">forex</span></code> has two quantified formulas, then the first quantified formula has zero polarity.</p></li>
<li><p>The variable declarations of a <code class="docutils literal notranslate"><span class="pre">forex</span></code> have zero polarity.</p></li>
<li><p>In all other cases, a formula or expression has the same polarity as its immediately enclosing formula or expression.</p></li>
</ul>
<p>For a member predicate <code class="docutils literal notranslate"><span class="pre">p</span></code> we define the <em>strict dispatch dependencies</em>. The strict dispatch dependencies are defined as:</p>
<ul class="simple">
<li><p>The strict dispatch dependencies of any predicates that override <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">p</span></code> is not abstract, <code class="docutils literal notranslate"><span class="pre">C.class</span></code> for any class <code class="docutils literal notranslate"><span class="pre">C</span></code> with a predicate that overrides <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
</ul>
<p>For a member predicate <code class="docutils literal notranslate"><span class="pre">p</span></code> we define the <em>dispatch dependencies</em>. The dispatch dependencies are defined as:</p>
<ul class="simple">
<li><p>The dispatch dependencies of predicates that override <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
<li><p>The predicate <code class="docutils literal notranslate"><span class="pre">p</span></code> itself.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C.class</span></code> where <code class="docutils literal notranslate"><span class="pre">C</span></code> is the class that defines <code class="docutils literal notranslate"><span class="pre">p</span></code>.</p></li>
</ul>
<p>Predicates, and types can <em>depend</em> and <em>strictly depend</em> on each other. Such dependencies exist in the following circumstances:</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">A</span></code> strictly depends on <code class="docutils literal notranslate"><span class="pre">B</span></code>, then <code class="docutils literal notranslate"><span class="pre">A</span></code> depends on <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">A</span></code> depends on <code class="docutils literal notranslate"><span class="pre">B</span></code>, then <code class="docutils literal notranslate"><span class="pre">A</span></code> also depends on anything on which <code class="docutils literal notranslate"><span class="pre">B</span></code> depends.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">A</span></code> strictly depends on <code class="docutils literal notranslate"><span class="pre">B</span></code>, then <code class="docutils literal notranslate"><span class="pre">A</span></code> and anything depending on <code class="docutils literal notranslate"><span class="pre">A</span></code> strictly depend on anything on which <code class="docutils literal notranslate"><span class="pre">B</span></code> depends (including <code class="docutils literal notranslate"><span class="pre">B</span></code> itself).</p></li>
<li><p>If a predicate has a parameter whose declared type is a class type <code class="docutils literal notranslate"><span class="pre">C</span></code>, it depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><p>If a predicate declares a result type which is a class type <code class="docutils literal notranslate"><span class="pre">C</span></code>, it depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><p>A member predicate of class <code class="docutils literal notranslate"><span class="pre">C</span></code> depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><p>If a predicate contains a variable declaration of a variable whose declared type is a class type <code class="docutils literal notranslate"><span class="pre">C</span></code>, then the predicate depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>. If the declaration has negative or zero polarity then the dependency is strict.</p></li>
<li><p>If a predicate contains a variable declaration with negative or zero polarity of a variable whose declared type is a class type <code class="docutils literal notranslate"><span class="pre">C</span></code>, then the predicate strictly depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><p>If a predicate contains an expression whose type is a class type <code class="docutils literal notranslate"><span class="pre">C</span></code> which is not a variable reference, then the predicate depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>. If the expression has negative or zero polarity then the dependency is strict.</p></li>
<li><p>A predicate containing a predicate call depends on the predicate to which the call resolves. If the call has negative or zero polarity then the dependency is strict.</p></li>
<li><p>A predicate containing a predicate call, which resolves to a member predicate and does not have a <code class="docutils literal notranslate"><span class="pre">super</span></code> expression as a qualifier, depends on the dispatch dependencies of the root definitions of the target of the call. If the call has negative or zero polarity then the dependencies are strict. The predicate strictly depends on the strict dispatch dependencies of the root definitions.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">C</span></code> in the program, for each base class <code class="docutils literal notranslate"><span class="pre">B</span></code> of <code class="docutils literal notranslate"><span class="pre">C</span></code>, <code class="docutils literal notranslate"><span class="pre">C.extends</span></code> depends on <code class="docutils literal notranslate"><span class="pre">B.B</span></code>.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">C</span></code> in the program, for each base type <code class="docutils literal notranslate"><span class="pre">B</span></code> of <code class="docutils literal notranslate"><span class="pre">C</span></code> that is not a class type, <code class="docutils literal notranslate"><span class="pre">C.extends</span></code> depends on <code class="docutils literal notranslate"><span class="pre">B</span></code>.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">C</span></code> in the program, <code class="docutils literal notranslate"><span class="pre">C.class</span></code> depends on <code class="docutils literal notranslate"><span class="pre">C.C</span></code>.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">C</span></code> in the program, <code class="docutils literal notranslate"><span class="pre">C.C</span></code> depends on <code class="docutils literal notranslate"><span class="pre">C.extends</span></code>.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">C</span></code> in the program that declares a field of class type <code class="docutils literal notranslate"><span class="pre">B</span></code>, <code class="docutils literal notranslate"><span class="pre">C.C</span></code> depends on <code class="docutils literal notranslate"><span class="pre">B.class</span></code>.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">C</span></code> with a characteristic predicate, <code class="docutils literal notranslate"><span class="pre">C.C</span></code> depends on the characteristic predicate.</p></li>
<li><p>For each abstract class <code class="docutils literal notranslate"><span class="pre">A</span></code> in the program, for each type <code class="docutils literal notranslate"><span class="pre">C</span></code> that has <code class="docutils literal notranslate"><span class="pre">A</span></code> as a base type, <code class="docutils literal notranslate"><span class="pre">A.class</span></code> depends on <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><p>A predicate with a higher-order body may strictly depend or depend on each predicate reference within the body. The exact dependencies are left unspecified.</p></li>
</ul>
<p>A valid stratification must have no predicate that depends on a predicate in a later layer. Additionally, it must have no predicate that strictly depends on a predicate in the same layer.</p>
<p>If a QL program has no valid stratification, then the program itself is not valid. If it does have a stratification, a QL implementation must choose exactly one stratification. The precise stratification chosen is left unspecified.</p>
</section>
<section id="layer-evaluation">
<h3>Layer evaluation<a class="headerlink" href="#layer-evaluation" title="Link to this heading">¶</a></h3>
<p>The store is first initialized with the <em>database content</em> of all built-in predicates and external predicates. The database content of a predicate is a set of ordered tuples that are included in the database.</p>
<p>Each layer of the stratification is <em>populated</em> in order. To populate a layer, each predicate in the layer is repeatedly populated until the store stops changing. The way that a predicate is populated is as follows:</p>
<ul>
<li><p>To populate a predicate that has a formula as a body, find each named tuple <code class="docutils literal notranslate"><span class="pre">t</span></code> that has the following properties:</p>
<blockquote>
<div><ul class="simple">
<li><p>The tuple matches the body formula.</p></li>
<li><p>The variables should be the predicate’s arguments.</p></li>
<li><p>If the predicate has a result, then the tuples should additionally have a value for <code class="docutils literal notranslate"><span class="pre">result</span></code>.</p></li>
<li><p>If the predicate is a member predicate or characteristic predicate of a class <code class="docutils literal notranslate"><span class="pre">C</span></code> then the tuples should additionally have a value for <code class="docutils literal notranslate"><span class="pre">this</span></code> and each visible field on the class.</p></li>
<li><p>The values corresponding to the arguments should all be a member of the declared types of the arguments.</p></li>
<li><p>The values corresponding to <code class="docutils literal notranslate"><span class="pre">result</span></code> should all be a member of the result type.</p></li>
<li><p>The values corresponding to the fields should all be a member of the declared types of the fields.</p></li>
<li><p>If the predicate is a member predicate of a class <code class="docutils literal notranslate"><span class="pre">C</span></code> and not a characteristic predicate, then the tuples should additionally extend some tuple in <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><p>If the predicate is a characteristic predicate of a class <code class="docutils literal notranslate"><span class="pre">C</span></code>, then there should be a tuple <code class="docutils literal notranslate"><span class="pre">t'</span></code> in <code class="docutils literal notranslate"><span class="pre">C.extends</span></code> such that for each visible field in <code class="docutils literal notranslate"><span class="pre">C</span></code>, any field that is equal to or overrides a field in <code class="docutils literal notranslate"><span class="pre">t'</span></code> should have the same value in <code class="docutils literal notranslate"><span class="pre">t</span></code>. <code class="docutils literal notranslate"><span class="pre">this</span></code> should also map to the same value in <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">t'</span></code>.</p></li>
</ul>
</div></blockquote>
<p>For each such tuple remove any components that correspond to fields and add it to the predicate in the store.</p>
</li>
<li><p>To populate an abstract predicate, do nothing.</p></li>
<li><p>The population of predicates with a higher-order body is left only partially specified. A number of tuples are added to the given predicate in the store. The tuples that are added must be fully determined by the QL program and by the state of the store.</p></li>
<li><p>To populate the type <code class="docutils literal notranslate"><span class="pre">C.extends</span></code> for a class <code class="docutils literal notranslate"><span class="pre">C</span></code>, identify each named tuple that has the following properties:</p>
<blockquote>
<div><ul class="simple">
<li><p>The value of <code class="docutils literal notranslate"><span class="pre">this</span></code> is in all non-class base types of <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p></li>
<li><p>The keys of the tuple are <code class="docutils literal notranslate"><span class="pre">this</span></code> and the union of the public fields from each base type.</p></li>
<li><p>For each class base type <code class="docutils literal notranslate"><span class="pre">B</span></code> of <code class="docutils literal notranslate"><span class="pre">C</span></code> there is a named tuple with variables from the public fields of <code class="docutils literal notranslate"><span class="pre">B</span></code> and <code class="docutils literal notranslate"><span class="pre">this</span></code> that the given tuple and some tuple in <code class="docutils literal notranslate"><span class="pre">B.B</span></code> both extend.</p></li>
</ul>
</div></blockquote>
<p>For each such tuple add it to <code class="docutils literal notranslate"><span class="pre">C.extends</span></code>.</p>
</li>
<li><p>To populate the type <code class="docutils literal notranslate"><span class="pre">C.C</span></code> for a class <code class="docutils literal notranslate"><span class="pre">C</span></code>, if <code class="docutils literal notranslate"><span class="pre">C</span></code> has a characteristic predicate, then add all tuples from that predicate to the store. Otherwise add all tuples <code class="docutils literal notranslate"><span class="pre">t</span></code> such that:</p>
<blockquote>
<div><ul class="simple">
<li><p>The variables of <code class="docutils literal notranslate"><span class="pre">t</span></code> should be <code class="docutils literal notranslate"><span class="pre">this</span></code> and the visible fields of <code class="docutils literal notranslate"><span class="pre">C</span></code>.</p></li>
<li><p>The values corresponding to the fields should all be a member of the declared types of the fields.</p></li>
<li><p>If the predicate is a characteristic predicate of a class <code class="docutils literal notranslate"><span class="pre">C</span></code>, then there should be a tuple <code class="docutils literal notranslate"><span class="pre">t'</span></code> in <code class="docutils literal notranslate"><span class="pre">C.extends</span></code> such that for each visible field in <code class="docutils literal notranslate"><span class="pre">C</span></code>, any field that is equal to or overrides a field in <code class="docutils literal notranslate"><span class="pre">t'</span></code> should have the same value in <code class="docutils literal notranslate"><span class="pre">t</span></code>. <code class="docutils literal notranslate"><span class="pre">this</span></code> should also map to the same value in <code class="docutils literal notranslate"><span class="pre">t</span></code> and <code class="docutils literal notranslate"><span class="pre">t'</span></code>.</p></li>
</ul>
</div></blockquote>
</li>
<li><p>To populate the type <code class="docutils literal notranslate"><span class="pre">C.class</span></code> for a non-abstract class type <code class="docutils literal notranslate"><span class="pre">C</span></code>, add each tuple in <code class="docutils literal notranslate"><span class="pre">C.C</span></code> to <code class="docutils literal notranslate"><span class="pre">C.class</span></code>.</p></li>
<li><dl class="simple">
<dt>To populate the type <code class="docutils literal notranslate"><span class="pre">C.class</span></code> for an abstract class type <code class="docutils literal notranslate"><span class="pre">C</span></code>, identify each named tuple that has the following properties:</dt><dd><ul class="simple">
<li><p>It is a member of <code class="docutils literal notranslate"><span class="pre">C.C</span></code>.</p></li>
<li><p>For each class <code class="docutils literal notranslate"><span class="pre">D</span></code> that has <code class="docutils literal notranslate"><span class="pre">C</span></code> as a base type then there is a named tuple with variables from the public fields of <code class="docutils literal notranslate"><span class="pre">C</span></code> and <code class="docutils literal notranslate"><span class="pre">this</span></code> that the given tuple and a tuple in <code class="docutils literal notranslate"><span class="pre">D.class</span></code> both extend.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="query-evaluation">
<h3>Query evaluation<a class="headerlink" href="#query-evaluation" title="Link to this heading">¶</a></h3>
<p>A query is evaluated as follows:</p>
<ol class="arabic simple">
<li><p>Identify all facts about query predicates.</p></li>
<li><p>If there is a select clause then find all named tuples with the variables declared in the <code class="docutils literal notranslate"><span class="pre">from</span></code> clause that match the formula given in the <code class="docutils literal notranslate"><span class="pre">where</span></code> clause, if there is one. For each named tuple, convert it to a set of ordered tuples where each element of the ordered tuple is, in the context of the named tuple, a value of one of the corresponding select expressions. Then sequence the ordered tuples lexicographically. The first elements of the lexicographic order are the tuple elements specified by the ordering directives of the predicate targeted by the query, if it has any. Each such element is ordered either ascending (<code class="docutils literal notranslate"><span class="pre">asc</span></code>) or descending (<code class="docutils literal notranslate"><span class="pre">desc</span></code>) as specified by the ordering directive, or ascending if the ordering directive does not specify. This lexicographic order is only a partial order, if there are fewer ordering directives than elements of the tuples. An implementation may produce any sequence of the ordered tuples that satisfies this partial order.</p></li>
<li><p>The result is the facts from the query predicates plus the list of ordered tuples from the select clause if it exists.</p></li>
</ol>
</section>
</section>
<section id="summary-of-syntax">
<h2>Summary of syntax<a class="headerlink" href="#summary-of-syntax" title="Link to this heading">¶</a></h2>
<p>The complete grammar for QL is as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>ql ::= qldoc? moduleBody

module ::= annotation* &quot;module&quot; modulename &quot;{&quot; moduleBody &quot;}&quot;

moduleBody ::= (import | predicate | class | module | alias | select)*

import ::= annotations &quot;import&quot; importModuleId (&quot;as&quot; modulename)?

qualId ::= simpleId | qualId &quot;.&quot; simpleId

importModuleId ::= qualId
               | importModuleId &quot;::&quot; simpleId

select ::= (&quot;from&quot; var_decls)? (&quot;where&quot; formula)? &quot;select&quot; as_exprs (&quot;order&quot; &quot;by&quot; orderbys)?

as_exprs ::= as_expr (&quot;,&quot; as_expr)*

as_expr ::= expr (&quot;as&quot; simpleId)?

orderbys ::= orderby (&quot;,&quot; orderby)*

orderby ::= simpleId (&quot;asc&quot; | &quot;desc&quot;)?

predicate ::= qldoc? annotations head optbody

annotations ::= annotation*

annotation ::= simpleAnnotation | argsAnnotation

simpleAnnotation ::= &quot;abstract&quot;
                 |   &quot;cached&quot;
                 |   &quot;external&quot;
                 |   &quot;final&quot;
                 |   &quot;transient&quot;
                 |   &quot;library&quot;
                 |   &quot;private&quot;
                 |   &quot;deprecated&quot;
                 |   &quot;override&quot;
                 |   &quot;query&quot;

argsAnnotation ::= &quot;pragma&quot; &quot;[&quot; (&quot;noinline&quot; | &quot;nomagic&quot; | &quot;noopt&quot;) &quot;]&quot;
               |   &quot;language&quot; &quot;[&quot; &quot;monotonicAggregates&quot; &quot;]&quot;
               |   &quot;bindingset&quot; &quot;[&quot; (variable ( &quot;,&quot; variable)*)? &quot;]&quot;

head ::= (&quot;predicate&quot; | type) predicateName &quot;(&quot; var_decls &quot;)&quot;

optbody ::= &quot;;&quot;
        |  &quot;{&quot; formula &quot;}&quot;
        |  &quot;=&quot; literalId &quot;(&quot; (predicateRef &quot;/&quot; int (&quot;,&quot; predicateRef &quot;/&quot; int)*)? &quot;)&quot; &quot;(&quot; (exprs)? &quot;)&quot;

class ::= qldoc? annotations &quot;class&quot; classname &quot;extends&quot; type (&quot;,&quot; type)* &quot;{&quot; member* &quot;}&quot;

member ::= character | predicate | field

character ::= qldoc? annotations classname &quot;(&quot; &quot;)&quot; &quot;{&quot; formula &quot;}&quot;

field ::= qldoc? annotations var_decl &quot;;&quot;

moduleId ::= simpleId | moduleId &quot;::&quot; simpleId

type ::= (moduleId &quot;::&quot;)? classname | dbasetype | &quot;boolean&quot; | &quot;date&quot; | &quot;float&quot; | &quot;int&quot; | &quot;string&quot;

exprs ::= expr (&quot;,&quot; expr)*

alias ::= qldoc? annotations &quot;predicate&quot; literalId &quot;=&quot; predicateRef &quot;/&quot; int &quot;;&quot;
      |  qldoc? annotations &quot;class&quot; classname &quot;=&quot; type &quot;;&quot;
      |  qldoc? annotations &quot;module&quot; modulename &quot;=&quot; moduleId &quot;;&quot;

var_decls ::= (var_decl (&quot;,&quot; var_decl)*)?

var_decl ::= type simpleId

formula ::= fparen
        |   disjunction
        |   conjunction
        |   implies
        |   ifthen
        |   negated
        |   quantified
        |   comparison
        |   instanceof
        |   inrange
        |   call

fparen ::= &quot;(&quot; formula &quot;)&quot;

disjunction ::= formula &quot;or&quot; formula

conjunction ::= formula &quot;and&quot; formula

implies ::= formula &quot;implies&quot; formula

ifthen ::= &quot;if&quot; formula &quot;then&quot; formula &quot;else&quot; formula

negated ::= &quot;not&quot; formula

quantified ::= &quot;exists&quot; &quot;(&quot; expr &quot;)&quot;
           |   &quot;exists&quot; &quot;(&quot; var_decls (&quot;|&quot; formula)? (&quot;|&quot; formula)? &quot;)&quot;
           |   &quot;forall&quot; &quot;(&quot; var_decls (&quot;|&quot; formula)? &quot;|&quot; formula &quot;)&quot;
           |   &quot;forex&quot;  &quot;(&quot; var_decls (&quot;|&quot; formula)? &quot;|&quot; formula &quot;)&quot;

comparison ::= expr compop expr

compop ::= &quot;=&quot; | &quot;!=&quot; | &quot;&lt;&quot; | &quot;&gt;&quot; | &quot;&lt;=&quot; | &quot;&gt;=&quot;

instanceof ::= expr &quot;instanceof&quot; type

inrange ::= expr &quot;in&quot; range

call ::= predicateRef (closure)? &quot;(&quot; (exprs)? &quot;)&quot;
     |   primary &quot;.&quot; predicateName (closure)? &quot;(&quot; (exprs)? &quot;)&quot;

closure ::= &quot;*&quot; | &quot;+&quot;

expr ::= dontcare
     |   unop
     |   binop
     |   cast
     |   primary


primary ::= eparen
        |   literal
        |   variable
        |   super_expr
        |   postfix_cast
        |   callwithresults
        |   aggregation
        |   any
        |   range
        |   setliteral

eparen ::= &quot;(&quot; expr &quot;)&quot;

dontcare ::= &quot;_&quot;

literal ::= &quot;false&quot; | &quot;true&quot; | int | float | string

unop ::= &quot;+&quot; expr
     |   &quot;-&quot; expr

binop ::= expr &quot;+&quot; expr
      |   expr &quot;-&quot; expr
      |   expr &quot;*&quot; expr
      |   expr &quot;/&quot; expr
      |   expr &quot;%&quot; expr

variable ::= varname | &quot;this&quot; | &quot;result&quot;

super_expr ::= &quot;super&quot; | type &quot;.&quot; &quot;super&quot;

cast ::= &quot;(&quot; type &quot;)&quot; expr

postfix_cast ::= primary &quot;.&quot; &quot;(&quot; type &quot;)&quot;

aggregation ::= aggid (&quot;[&quot; expr &quot;]&quot;)? &quot;(&quot; var_decls (&quot;|&quot; (formula)? (&quot;|&quot; as_exprs (&quot;order&quot; &quot;by&quot; aggorderbys)?)?)? &quot;)&quot;
            |   aggid (&quot;[&quot; expr &quot;]&quot;)? &quot;(&quot; as_exprs (&quot;order&quot; &quot;by&quot; aggorderbys)? &quot;)&quot;
            |   &quot;unique&quot; &quot;(&quot; var_decls &quot;|&quot; (formula)? (&quot;|&quot; as_exprs)? &quot;)&quot;

aggid ::= &quot;avg&quot; | &quot;concat&quot; | &quot;count&quot; | &quot;max&quot; | &quot;min&quot; | &quot;rank&quot; | &quot;strictconcat&quot; | &quot;strictcount&quot; | &quot;strictsum&quot; | &quot;sum&quot;

aggorderbys ::= aggorderby (&quot;,&quot; aggorderby)*

aggorderby ::= expr (&quot;asc&quot; | &quot;desc&quot;)?

any ::= &quot;any&quot; &quot;(&quot; var_decls (&quot;|&quot; (formula)? (&quot;|&quot; expr)?)? &quot;)&quot;

callwithresults ::= predicateRef (closure)? &quot;(&quot; (exprs)? &quot;)&quot;
                |   primary &quot;.&quot; predicateName (closure)? &quot;(&quot; (exprs)? &quot;)&quot;

range ::= &quot;[&quot; expr &quot;..&quot; expr &quot;]&quot;

setliteral ::= &quot;[&quot; expr (&quot;,&quot; expr)* &quot;,&quot;? &quot;]&quot;

simpleId ::= lowerId | upperId

modulename ::= simpleId

classname ::= upperId

dbasetype ::= atLowerId

predicateRef ::= (moduleId &quot;::&quot;)? literalId

predicateName ::= lowerId

varname ::= simpleId

literalId ::= lowerId | atLowerId | &quot;any&quot; | &quot;none&quot;
</pre></div>
</div>
</section>
</section>


    </article>

    <!-- GitHub footer, with links to terms and privacy statement -->
    <div class="px-3 px-md-6 f6 py-4 d-sm-flex flex-justify-between flex-row-reverse flex-items-center border-top">
        <ul class="list-style-none d-flex flex-items-center mb-3 mb-sm-0 lh-condensed-ultra">
            <li class="mr-3">
                <a href="https://twitter.com/github" title="GitHub on Twitter" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 273.5 222.3" class="d-block" height="18">
                        <path
                            d="M273.5 26.3a109.77 109.77 0 0 1-32.2 8.8 56.07 56.07 0 0 0 24.7-31 113.39 113.39 0 0 1-35.7 13.6 56.1 56.1 0 0 0-97 38.4 54 54 0 0 0 1.5 12.8A159.68 159.68 0 0 1 19.1 10.3a56.12 56.12 0 0 0 17.4 74.9 56.06 56.06 0 0 1-25.4-7v.7a56.11 56.11 0 0 0 45 55 55.65 55.65 0 0 1-14.8 2 62.39 62.39 0 0 1-10.6-1 56.24 56.24 0 0 0 52.4 39 112.87 112.87 0 0 1-69.7 24 119 119 0 0 1-13.4-.8 158.83 158.83 0 0 0 86 25.2c103.2 0 159.6-85.5 159.6-159.6 0-2.4-.1-4.9-.2-7.3a114.25 114.25 0 0 0 28.1-29.1"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.facebook.com/GitHub" title="GitHub on Facebook" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.3 15.4" class="d-block" height="18">
                        <path
                            d="M14.5 0H.8a.88.88 0 0 0-.8.9v13.6a.88.88 0 0 0 .8.9h7.3v-6h-2V7.1h2V5.4a2.87 2.87 0 0 1 2.5-3.1h.5a10.87 10.87 0 0 1 1.8.1v2.1h-1.3c-1 0-1.1.5-1.1 1.1v1.5h2.3l-.3 2.3h-2v5.9h3.9a.88.88 0 0 0 .9-.8V.8a.86.86 0 0 0-.8-.8z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.youtube.com/github" title="GitHub on YouTube" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.17 13.6" class="d-block" height="16">
                        <path
                            d="M18.77 2.13A2.4 2.4 0 0 0 17.09.42C15.59 0 9.58 0 9.58 0a57.55 57.55 0 0 0-7.5.4A2.49 2.49 0 0 0 .39 2.13 26.27 26.27 0 0 0 0 6.8a26.15 26.15 0 0 0 .39 4.67 2.43 2.43 0 0 0 1.69 1.71c1.52.42 7.5.42 7.5.42a57.69 57.69 0 0 0 7.51-.4 2.4 2.4 0 0 0 1.68-1.71 25.63 25.63 0 0 0 .4-4.67 24 24 0 0 0-.4-4.69zM7.67 9.71V3.89l5 2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3 flex-self-start">
                <a href="https://www.linkedin.com/company/github" title="GitHub on Linkedin" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 18" class="d-block" height="18">
                        <path
                            d="M3.94 2A2 2 0 1 1 2 0a2 2 0 0 1 1.94 2zM4 5.48H0V18h4zm6.32 0H6.34V18h3.94v-6.57c0-3.66 4.77-4 4.77 0V18H19v-7.93c0-6.17-7.06-5.94-8.72-2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://github.com/github" title="GitHub's organization" style="color: #959da5;">
                    <svg version="1.1" width="20" height="20" viewBox="0 0 16 16" class="octicon octicon-mark-github"
                        aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                        </path>
                    </svg>
                </a>
            </li>
        </ul>
        <ul class="list-style-none d-flex text-gray">
            <li class="mr-3">&copy; 
                <script type="text/javascript">document.write(new Date().getFullYear());</script> GitHub, Inc.</li>
            <li class="mr-3"><a
                    href="https://docs.github.com/github/site-policy/github-terms-of-service"
                    class="link-gray">Terms </a></li>
            <li><a href="https://docs.github.com/github/site-policy/github-privacy-statement"
                    class="link-gray">Privacy </a></li>
        </ul>
    </div>
</div>
</main>

<script type="text/javascript">
    $(document).ready(function () {
        $(".toggle > *").hide();
        $(".toggle .name").show();
        $(".toggle .name").click(function () {
            $(this).parent().children().not(".name").toggle(400);
            $(this).parent().children(".name").toggleClass("open");
        })
    });
</script>

  </body>
</html>