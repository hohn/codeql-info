<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Testing custom queries &#8212; CodeQL</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=93459777" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Testing query help files" href="testing-query-help-files.html" />
    <link rel="prev" title="Creating CodeQL query suites" href="creating-codeql-query-suites.html" />

<title>CodeQL docs</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="../_static/custom.css" type="text/css" />
<link rel="stylesheet" href="../_static/primer.css" type="text/css" />


  </head><body>
<header class="Header">
    <div class="Header-item--full">
        <a href="https://codeql.github.com/docs" class="Header-link f2 d-flex flex-items-center">
            <!-- <%= octicon "mark-github", class: "mr-2", height: 32 %> -->
            <svg height="32" class="octicon octicon-mark-github mr-2" viewBox="0 0 16 16" version="1.1" width="32"
                aria-hidden="true">
                <path fill-rule="evenodd"
                    d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z">
                </path>
            </svg>
            <span class="hide-sm">CodeQL documentation</span>
        </a>
    </div>
    <div class="Header-item hide-sm hide-md">
        <script src="https://addsearch.com/js/?key=93b4d287e2fc079a4089412b669785d5&categories=!0xhelp.semmle.com,0xcodeql.github.com,1xdocs,1xcodeql-standard-libraries,1xcodeql-query-help"></script>
    </div>
    <div class="Header-item">

        <details class="dropdown details-reset details-overlay d-inline-block">
            <summary class="btn bg-gray-dark text-white border" aria-haspopup="true">
                CodeQL resources
                <div class="dropdown-caret"></div>
            </summary>

            <ul class="dropdown-menu dropdown-menu-se dropdown-menu-dark">
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-overview">CodeQL overview</a></li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    CodeQL tools
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-for-visual-studio-code">CodeQL for VS Code</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-cli">CodeQL CLI</a>
                </li>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    CodeQL guides
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/writing-codeql-queries">Writing CodeQL queries</a></li>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/codeql-language-guides">CodeQL language guides</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Reference docs
                </div>
                <li><a class="dropdown-item" href="https://codeql.github.com/docs/ql-language-reference/">QL language
                        reference</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/codeql-standard-libraries">CodeQL
                        standard-libraries</a>
                <li><a class="dropdown-item" href="https://codeql.github.com/codeql-query-help">CodeQL
                        query help</a>
                <li class="dropdown-divider" role="separator"></li>
                <div class="dropdown-header">
                    Source files
                </div>
                <li><a class="dropdown-item" href="https://github.com/github/codeql">CodeQL repository</a>
            </ul>
        </details>

    </div>

</header>
<main class="bg-gray-light clearfix">
<nav class="SideNav position-sticky top-0 col-lg-3 col-md-3 float-left p-4 hide-sm hide-md overflow-y-auto">

    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../codeql-overview/index.html">CodeQL overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-for-visual-studio-code/index.html">CodeQL for Visual Studio Code</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">CodeQL CLI</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="using-the-codeql-cli.html">Using the CodeQL CLI</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="about-the-codeql-cli.html">About the CodeQL CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="getting-started-with-the-codeql-cli.html">Getting started with the CodeQL CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating-codeql-databases.html">Creating CodeQL databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="extractor-options.html">Extractor options</a></li>
<li class="toctree-l3"><a class="reference internal" href="analyzing-databases-with-the-codeql-cli.html">Analyzing databases with the CodeQL CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="upgrading-codeql-databases.html">Upgrading CodeQL databases</a></li>
<li class="toctree-l3"><a class="reference internal" href="using-custom-queries-with-the-codeql-cli.html">Using custom queries with the CodeQL CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating-codeql-query-suites.html">Creating CodeQL query suites</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Testing custom queries</a></li>
<li class="toctree-l3"><a class="reference internal" href="testing-query-help-files.html">Testing query help files</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating-and-working-with-codeql-packs.html">Creating and working with CodeQL packs</a></li>
<li class="toctree-l3"><a class="reference internal" href="publishing-and-using-codeql-packs.html">Publishing and using CodeQL packs</a></li>
<li class="toctree-l3"><a class="reference internal" href="specifying-command-options-in-a-codeql-configuration-file.html">Specifying command options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="codeql-cli-reference.html">CodeQL CLI reference</a></li>
<li class="toctree-l2"><a class="reference external" href="https://codeql.github.com/docs/codeql-cli/manual">CodeQL CLI manual</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../writing-codeql-queries/index.html">Writing CodeQL queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codeql-language-guides/index.html">CodeQL language guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ql-language-reference/index.html">QL language reference</a></li>
</ul>


</nav>


<div class="body col-sm-12 col-md-9 col-lg-9 float-left border-left">

    <div class="hide-lg hide-xl px-4 pt-4">
        
<div class="related" role="navigation" aria-label="related navigation">
    <ul>
        <li class="nav-item nav-item-0"><a href="../contents.html">CodeQL</a> &#187;</li>
        <li class="nav-item nav-item-1"><a href="index.html"
                >CodeQL CLI</a> &#187;</li>
        <li class="nav-item nav-item-2"><a href="using-the-codeql-cli.html"
                accesskey="U">Using the CodeQL CLI</a> &#187;</li> 
    </ul>
</div>
    </div>

    <article class="p-4 col-lg-10 col-md-10 col-sm-12">
        
  <section id="testing-custom-queries">
<span id="id1"></span><h1>Testing custom queries<a class="headerlink" href="#testing-custom-queries" title="Link to this heading">¶</a></h1>
<p>CodeQL provides a simple test framework for automated regression testing
of queries. Test your queries to ensure that they behave as expected.</p>
<p>During a query test, CodeQL compares the results the user expects
the query to produce with those actually produced. If the expected and
actual results differ, the query test fails. To fix the test, you should iterate
on the query and the expected results until the actual results and the expected
results exactly match. This topic shows you how to create test files and execute
tests on them using the <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">run</span></code> subcommand.</p>
<section id="setting-up-a-test-ql-pack-for-custom-queries">
<h2>Setting up a test QL pack for custom queries<a class="headerlink" href="#setting-up-a-test-ql-pack-for-custom-queries" title="Link to this heading">¶</a></h2>
<p>All CodeQL tests must be stored in a special “test” QL pack.
That is, a directory for test files with a <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code>
file that defines:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;name-of-test-pack&gt;</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0</span>
<span class="nt">libraryPathDependencies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;codeql-libraries-and-queries-to-test&gt;</span>
<span class="nt">extractor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">&lt;language-of-code-to-test&gt;</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">libraryPathDependencies</span></code> value specifies the CodeQL queries to test.
The <code class="docutils literal notranslate"><span class="pre">extractor</span></code> defines which language the CLI will use
to create test databases from the code files stored in this QL pack.
For more information, see “<a class="reference internal" href="about-ql-packs.html"><span class="doc">About QL packs</span></a>.”</p>
<p>You may find it useful to look at the way query tests are organized in the
<a class="reference external" href="https://github.com/github/codeql">CodeQL repository</a>.
Each language has a <code class="docutils literal notranslate"><span class="pre">src</span></code> directory, <code class="docutils literal notranslate"><span class="pre">ql/&lt;language&gt;/ql/src</span></code>,
that contains libraries and queries for analyzing codebases.
Alongside the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory,
there’s a <code class="docutils literal notranslate"><span class="pre">test</span></code> directory with tests for these libraries and queries.</p>
<p>Each <code class="docutils literal notranslate"><span class="pre">test</span></code> directory is configured as a test QL pack with two subdirectories:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">query-tests</span></code> a series of subdirectories with tests for queries stored in the <code class="docutils literal notranslate"><span class="pre">src</span></code> directory.
Each subdirectory contains test code and a QL reference file that specifies the query to test.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">library-tests</span></code> a series of subdirectories with tests for QL library files.
Each subdirectory contains test code and queries that were written as unit tests for a library.</p></li>
</ul>
</section>
<section id="setting-up-the-test-files-for-a-query">
<h2>Setting up the test files for a query<a class="headerlink" href="#setting-up-the-test-files-for-a-query" title="Link to this heading">¶</a></h2>
<p>For each query you want to test, you should create a sub-directory in the test QL pack.
Then add the following files to the subdirectory before you run the test command:</p>
<ul>
<li><p>A query reference file (<code class="docutils literal notranslate"><span class="pre">.qlref</span></code> file) defining the location of the query to test.
The location is defined relative to the root of the QL pack that contains the
query. Usually, this is a QL pack specified by the
<code class="docutils literal notranslate"><span class="pre">libraryPathDependencies</span></code> for the test pack.
For more information, see “<a class="reference internal" href="query-reference-files.html"><span class="doc">Query reference files</span></a>.”</p>
<p>You don’t need to add a query reference file if the query you want to
test is stored in the test directory,
but it’s generally good practice to store queries separately from tests.
The only exception is unit tests for QL libraries, which tend to be
stored in test packs, separate from queries that generate alerts or paths.</p>
</li>
<li><p>The example code you want to run your query against. This
should consist of one or more files containing examples of the code the
query is designed to identify.</p></li>
</ul>
<p>You can also define the results you expect to see when you run the query against
the example code, by creating a file with the extension <code class="docutils literal notranslate"><span class="pre">.expected</span></code>.
Alternatively, you can leave the test command to create the <code class="docutils literal notranslate"><span class="pre">.expected</span></code> file
for you. (If you’re using CodeQL CLI 2.0.2–2.0.6, you need to create an
<code class="docutils literal notranslate"><span class="pre">.expected</span></code> file otherwise the command will fail to find your test query.
You can create an empty <code class="docutils literal notranslate"><span class="pre">.expected</span></code> file to workaround this limitation.)</p>
<p>For an example showing how to create and test a query, see the <a class="reference external" href="#example">example</a> below.</p>
<blockquote class="pull-quote">
<div><p>Important</p>
<p>Your <code class="docutils literal notranslate"><span class="pre">.ql</span></code>, <code class="docutils literal notranslate"><span class="pre">.qlref</span></code>, and <code class="docutils literal notranslate"><span class="pre">.expected</span></code> files must have consistent names.</p>
<p>If you want to directly specify the <code class="docutils literal notranslate"><span class="pre">.ql</span></code> file itself in the test command,
it must have the same base name as the corresponding <code class="docutils literal notranslate"><span class="pre">.expected</span></code> file. For
example, if the query is <code class="docutils literal notranslate"><span class="pre">MyJavaQuery.ql</span></code>, the expected results file must
be <code class="docutils literal notranslate"><span class="pre">MyJavaQuery.expected</span></code>.</p>
<p>If you want to specify a <code class="docutils literal notranslate"><span class="pre">.qlref</span></code> file in the command, it must have the same base
name as the corresponding <code class="docutils literal notranslate"><span class="pre">.expected</span></code> file, but the query itself
may have a different name.</p>
<p>The names of the example code files don’t have to be consistent with the
other test files. All example code files found next to the <code class="docutils literal notranslate"><span class="pre">.qlref</span></code> (or <code class="docutils literal notranslate"><span class="pre">.ql</span></code>)
file and in any subdirectories will be used to create a test database.
Therefore, for simplicity, we recommend you don’t save test files in
directories that are ancestors of each other.</p>
</div></blockquote>
</section>
<section id="running-codeql-test-run">
<h2>Running <code class="docutils literal notranslate"><span class="pre">codeql</span> <span class="pre">test</span> <span class="pre">run</span></code><a class="headerlink" href="#running-codeql-test-run" title="Link to this heading">¶</a></h2>
<p>CodeQL query tests are executed by running the following command:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>codeql test run &lt;test|dir&gt;
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&lt;test|dir&gt;</span></code> argument can be one or more of the following:</p>
<ul class="simple">
<li><p>Path to a <code class="docutils literal notranslate"><span class="pre">.ql</span></code> file.</p></li>
<li><p>Path to a <code class="docutils literal notranslate"><span class="pre">.qlref</span></code> file that references a <code class="docutils literal notranslate"><span class="pre">.ql</span></code> file.</p></li>
<li><p>Path to a directory that will be searched recursively for <code class="docutils literal notranslate"><span class="pre">.ql</span></code> and
<code class="docutils literal notranslate"><span class="pre">.qlref</span></code> files.</p></li>
</ul>
<p>You can also specify:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--threads</span></code>: optionally, the number of threads to use when running queries.
The default option is <code class="docutils literal notranslate"><span class="pre">1</span></code>. You can specify more threads to speed up query
execution. Specifying <code class="docutils literal notranslate"><span class="pre">0</span></code> matches the number of threads to the number of logical processors.</p></li>
</ul>
<p>For full details of all the options you can use when testing queries,
see the <a class="reference external" href="../manual/test-run">test run reference documentation</a>.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">¶</a></h2>
<p>The following example shows you how to set up a test for a query that searches
Java code for <code class="docutils literal notranslate"><span class="pre">if</span></code> statements that have empty <code class="docutils literal notranslate"><span class="pre">then</span></code> blocks. It includes
steps to add the custom query and corresponding test files to separate QL packs
outside your checkout of the CodeQL repository. This ensures when you update the
CodeQL libraries, or check out a different branch, you won’t overwrite your
custom queries and tests.</p>
<section id="prepare-a-query-and-test-files">
<h3>Prepare a query and test files<a class="headerlink" href="#prepare-a-query-and-test-files" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><p>Develop the query. For example, the following simple query finds empty <code class="docutils literal notranslate"><span class="pre">then</span></code>
blocks in Java code:</p>
<div class="highlight-ql notranslate"><div class="highlight"><pre><span></span>import java

from IfStmt ifstmt
where ifstmt.getThen() instanceof EmptyStmt
select ifstmt, &quot;This if statement has an empty then.&quot;
</pre></div>
</div>
</li>
<li><p>Save the query to a file named <code class="docutils literal notranslate"><span class="pre">EmptyThen.ql</span></code> in a directory with your
other custom queries. For example,
<code class="docutils literal notranslate"><span class="pre">custom-queries/java/queries/EmptyThen.ql</span></code>.</p></li>
<li><p>If you haven’t already added your custom queries to a QL pack,
create a QL pack now. For example, if your custom Java queries
are stored in <code class="docutils literal notranslate"><span class="pre">custom-queries/java/queries</span></code>, add a <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> file with the
following contents to <code class="docutils literal notranslate"><span class="pre">custom-queries/java/queries</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-custom-queries</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0</span>
<span class="nt">libraryPathDependencies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codeql-java</span>
</pre></div>
</div>
<p>For more information about QL packs, see “<a class="reference internal" href="about-ql-packs.html"><span class="doc">About QL packs</span></a>.”</p>
</li>
<li><p>Create a QL pack for your Java tests by adding a <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> file
with the following contents to <code class="docutils literal notranslate"><span class="pre">custom-queries/java/tests</span></code>,
updating <code class="docutils literal notranslate"><span class="pre">libraryPathDependencies</span></code> to match the name of your QL pack of custom queries:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-query-tests</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0</span>
<span class="nt">libraryPathDependencies</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-custom-queries</span>
<span class="nt">extractor</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">java</span>
<span class="nt">tests</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span>
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">qlpack.yml</span></code> file states that <code class="docutils literal notranslate"><span class="pre">my-query-tests</span></code> depends on
<code class="docutils literal notranslate"><span class="pre">my-custom-queries</span></code>. It also declares that the CLI should use the
Java <code class="docutils literal notranslate"><span class="pre">extractor</span></code> when creating test databases.
Supported from CLI 2.1.0 onward, the <code class="docutils literal notranslate"><span class="pre">tests:</span> <span class="pre">.</span></code> line declares
that all <code class="docutils literal notranslate"><span class="pre">.ql</span></code> files in the pack should be
run as tests when <code class="docutils literal notranslate"><span class="pre">codeql</span> <span class="pre">test</span> <span class="pre">run</span></code> is run with the
<code class="docutils literal notranslate"><span class="pre">--strict-test-discovery</span></code> option.</p>
</li>
<li><p>Within the Java test pack, create a directory to contain the test files
associated with <code class="docutils literal notranslate"><span class="pre">EmptyThen.ql</span></code>.
For example, <code class="docutils literal notranslate"><span class="pre">custom-queries/java/tests/EmptyThen</span></code>.</p></li>
<li><p>In the new directory, create <code class="docutils literal notranslate"><span class="pre">EmptyThen.qlref</span></code> to define the location of <code class="docutils literal notranslate"><span class="pre">EmptyThen.ql</span></code>.
The path to the query must be specified relative to the root of
the QL pack that contains the query. In this case, the query is in the
top level directory of the QL pack named <code class="docutils literal notranslate"><span class="pre">my-custom-queries</span></code>,
which is declared as a dependency for <code class="docutils literal notranslate"><span class="pre">my-query-tests</span></code>.
Therefore, <code class="docutils literal notranslate"><span class="pre">EmptyThen.qlref</span></code> should simply contain <code class="docutils literal notranslate"><span class="pre">EmptyThen.ql</span></code>.</p></li>
<li><p>Create a code snippet to test. The following Java code contains an
empty <code class="docutils literal notranslate"><span class="pre">if</span></code> statement on the third line. Save it in
<code class="docutils literal notranslate"><span class="pre">custom-queries/java/tests/EmptyThen/Test.java</span></code>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">class</span> <span class="nc">Test</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">problem</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span>
<span class="w">    </span><span class="p">;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Empty argument&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">good</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">arg</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Empty argument&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
<section id="execute-the-test">
<h3>Execute the test<a class="headerlink" href="#execute-the-test" title="Link to this heading">¶</a></h3>
<p>To execute the test, move into the <code class="docutils literal notranslate"><span class="pre">custom-queries</span></code> directory and run <code class="docutils literal notranslate"><span class="pre">codeql</span>
<span class="pre">test</span> <span class="pre">run</span> <span class="pre">java/tests/EmptyThen</span></code>.</p>
<p>When the test runs it:</p>
<ol class="arabic">
<li><p>Finds one test in the <code class="docutils literal notranslate"><span class="pre">EmptyThen</span></code> directory.</p></li>
<li><p>Extracts a CodeQL database from the <code class="docutils literal notranslate"><span class="pre">.java</span></code> files stored in the <code class="docutils literal notranslate"><span class="pre">EmptyThen</span></code> directory.</p></li>
<li><p>Compiles the query referenced by the <code class="docutils literal notranslate"><span class="pre">EmptyThen.qlref</span></code> file.</p>
<p>If this step fails, it’s because the CLI can’t find your custom QL pack.
Re-run the command and specify the location of your custom QL pack, for example:</p>
<p><code class="docutils literal notranslate"><span class="pre">codeql</span> <span class="pre">test</span> <span class="pre">run</span> <span class="pre">--search-path=java</span> <span class="pre">java/tests/EmptyThen</span></code></p>
<p>For information about saving the search path as part of your configuration, see
“<a class="reference internal" href="specifying-command-options-in-a-codeql-configuration-file.html#specifying-command-options-in-a-codeql-configuration-file"><span class="std std-ref">Specifying command options in a CodeQL configuration file</span></a>.”</p>
</li>
<li><p>Executes the test by running the query and generating an <code class="docutils literal notranslate"><span class="pre">EmptyThen.actual</span></code> results file.</p></li>
<li><p>Checks for an <code class="docutils literal notranslate"><span class="pre">EmptyThen.expected</span></code> file to compare with the <code class="docutils literal notranslate"><span class="pre">.actual</span></code> results file.</p></li>
<li><p>Reports the results of the test — in this case, a failure: <code class="docutils literal notranslate"><span class="pre">0</span> <span class="pre">tests</span> <span class="pre">passed;</span> <span class="pre">1</span> <span class="pre">tests</span> <span class="pre">failed:</span></code>.
The test failed because we haven’t yet added a file with the expected results of the query.</p></li>
</ol>
</section>
<section id="view-the-query-test-output">
<h3>View the query test output<a class="headerlink" href="#view-the-query-test-output" title="Link to this heading">¶</a></h3>
<p>CodeQL generates the following files in the <code class="docutils literal notranslate"><span class="pre">EmptyThen</span></code> directory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">EmptyThen.actual</span></code>, a file that contains the actual results generated by the
query.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">EmptyThen.testproj</span></code>, a test database that you can load into VS Code and use to debug failing tests.
When tests complete successfully, this database is deleted in a housekeeping step.
You can override this step by running <code class="docutils literal notranslate"><span class="pre">test</span> <span class="pre">run</span></code> with the <code class="docutils literal notranslate"><span class="pre">--keep-databases</span></code> option.</p></li>
</ul>
<p>In this case, the failure was expected and is easy to fix.
If you open the <code class="docutils literal notranslate"><span class="pre">EmptyThen.actual</span></code> file, you can see the results of the test:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>| Test.java:3:5:3:22 | stmt | This if statement has an empty then. |
</pre></div>
</div>
</div></blockquote>
<p>This file contains a table, with a column for the location of the result,
along with separate columns for each part of the <code class="docutils literal notranslate"><span class="pre">select</span></code> clause the query outputs.
Since the results are what we expected, we can update the file extension to define
this as the expected result for this test (<code class="docutils literal notranslate"><span class="pre">EmptyThen.expected</span></code>).</p>
<p>If you rerun the test now, the output will be similar but it will finish by reporting:
<code class="docutils literal notranslate"><span class="pre">All</span> <span class="pre">1</span> <span class="pre">tests</span> <span class="pre">passed.</span></code>.</p>
<p>If the results of the query change, for example, if you revise the <code class="docutils literal notranslate"><span class="pre">select</span></code> statement for the query,
the test will fail. For failed results, the CLI output includes a unified diff of the
<code class="docutils literal notranslate"><span class="pre">EmptyThen.expected</span></code> and <code class="docutils literal notranslate"><span class="pre">EmptyThen.actual</span></code> files.
This information may be sufficient to debug trivial test failures.</p>
<p>For failures that are harder to debug, you can import <code class="docutils literal notranslate"><span class="pre">EmptyThen.testproj</span></code>
into CodeQL for VS Code, execute <code class="docutils literal notranslate"><span class="pre">EmptyThen.ql</span></code>, and view the results in the
<code class="docutils literal notranslate"><span class="pre">Test.java</span></code> example code. For more information, see “<a class="reference internal" href="../codeql-for-visual-studio-code/analyzing-your-projects.html#analyzing-your-projects"><span class="std std-ref">Analyzing your projects</span></a>” in the CodeQL for VS Code
help.</p>
</section>
</section>
<section id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>“<a class="reference internal" href="../writing-codeql-queries/codeql-queries.html#codeql-queries"><span class="std std-ref">CodeQL queries</span></a>”</p></li>
<li><p>“<a class="reference internal" href="../codeql-for-visual-studio-code/testing-codeql-queries-in-visual-studio-code.html#testing-codeql-queries-in-visual-studio-code"><span class="std std-ref">Testing CodeQL queries in Visual Studio Code</span></a>”</p></li>
</ul>
</section>
</section>


    </article>

    <!-- GitHub footer, with links to terms and privacy statement -->
    <div class="px-3 px-md-6 f6 py-4 d-sm-flex flex-justify-between flex-row-reverse flex-items-center border-top">
        <ul class="list-style-none d-flex flex-items-center mb-3 mb-sm-0 lh-condensed-ultra">
            <li class="mr-3">
                <a href="https://twitter.com/github" title="GitHub on Twitter" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 273.5 222.3" class="d-block" height="18">
                        <path
                            d="M273.5 26.3a109.77 109.77 0 0 1-32.2 8.8 56.07 56.07 0 0 0 24.7-31 113.39 113.39 0 0 1-35.7 13.6 56.1 56.1 0 0 0-97 38.4 54 54 0 0 0 1.5 12.8A159.68 159.68 0 0 1 19.1 10.3a56.12 56.12 0 0 0 17.4 74.9 56.06 56.06 0 0 1-25.4-7v.7a56.11 56.11 0 0 0 45 55 55.65 55.65 0 0 1-14.8 2 62.39 62.39 0 0 1-10.6-1 56.24 56.24 0 0 0 52.4 39 112.87 112.87 0 0 1-69.7 24 119 119 0 0 1-13.4-.8 158.83 158.83 0 0 0 86 25.2c103.2 0 159.6-85.5 159.6-159.6 0-2.4-.1-4.9-.2-7.3a114.25 114.25 0 0 0 28.1-29.1"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.facebook.com/GitHub" title="GitHub on Facebook" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.3 15.4" class="d-block" height="18">
                        <path
                            d="M14.5 0H.8a.88.88 0 0 0-.8.9v13.6a.88.88 0 0 0 .8.9h7.3v-6h-2V7.1h2V5.4a2.87 2.87 0 0 1 2.5-3.1h.5a10.87 10.87 0 0 1 1.8.1v2.1h-1.3c-1 0-1.1.5-1.1 1.1v1.5h2.3l-.3 2.3h-2v5.9h3.9a.88.88 0 0 0 .9-.8V.8a.86.86 0 0 0-.8-.8z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3">
                <a href="https://www.youtube.com/github" title="GitHub on YouTube" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.17 13.6" class="d-block" height="16">
                        <path
                            d="M18.77 2.13A2.4 2.4 0 0 0 17.09.42C15.59 0 9.58 0 9.58 0a57.55 57.55 0 0 0-7.5.4A2.49 2.49 0 0 0 .39 2.13 26.27 26.27 0 0 0 0 6.8a26.15 26.15 0 0 0 .39 4.67 2.43 2.43 0 0 0 1.69 1.71c1.52.42 7.5.42 7.5.42a57.69 57.69 0 0 0 7.51-.4 2.4 2.4 0 0 0 1.68-1.71 25.63 25.63 0 0 0 .4-4.67 24 24 0 0 0-.4-4.69zM7.67 9.71V3.89l5 2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li class="mr-3 flex-self-start">
                <a href="https://www.linkedin.com/company/github" title="GitHub on Linkedin" style="color: #959da5;">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 18" class="d-block" height="18">
                        <path
                            d="M3.94 2A2 2 0 1 1 2 0a2 2 0 0 1 1.94 2zM4 5.48H0V18h4zm6.32 0H6.34V18h3.94v-6.57c0-3.66 4.77-4 4.77 0V18H19v-7.93c0-6.17-7.06-5.94-8.72-2.91z"
                            fill="currentColor"></path>
                    </svg>
                </a>
            </li>
            <li>
                <a href="https://github.com/github" title="GitHub's organization" style="color: #959da5;">
                    <svg version="1.1" width="20" height="20" viewBox="0 0 16 16" class="octicon octicon-mark-github"
                        aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z">
                        </path>
                    </svg>
                </a>
            </li>
        </ul>
        <ul class="list-style-none d-flex text-gray">
            <li class="mr-3">&copy; 
                <script type="text/javascript">document.write(new Date().getFullYear());</script> GitHub, Inc.</li>
            <li class="mr-3"><a
                    href="https://docs.github.com/github/site-policy/github-terms-of-service"
                    class="link-gray">Terms </a></li>
            <li><a href="https://docs.github.com/github/site-policy/github-privacy-statement"
                    class="link-gray">Privacy </a></li>
        </ul>
    </div>
</div>
</main>

<script type="text/javascript">
    $(document).ready(function () {
        $(".toggle > *").hide();
        $(".toggle .name").show();
        $(".toggle .name").click(function () {
            $(this).parent().children().not(".name").toggle(400);
            $(this).parent().children(".name").toggleClass("open");
        })
    });
</script>

  </body>
</html>